This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
Cargo.toml
LICENSE
package.json
postcss.config.js
README.md
src-tauri/build.rs
src-tauri/capabilities/default.json
src-tauri/Cargo.toml
src-tauri/custom/internal.yaml
src-tauri/custom/private.yaml
src-tauri/icons/128x128.png
src-tauri/icons/128x128@2x.png
src-tauri/icons/32x32.png
src-tauri/icons/icon.icns
src-tauri/icons/icon.ico
src-tauri/icons/icon.png
src-tauri/icons/Square107x107Logo.png
src-tauri/icons/Square142x142Logo.png
src-tauri/icons/Square150x150Logo.png
src-tauri/icons/Square284x284Logo.png
src-tauri/icons/Square30x30Logo.png
src-tauri/icons/Square310x310Logo.png
src-tauri/icons/Square44x44Logo.png
src-tauri/icons/Square71x71Logo.png
src-tauri/icons/Square89x89Logo.png
src-tauri/icons/StoreLogo.png
src-tauri/rules/auth/ai/keys.yaml
src-tauri/rules/auth/database/urls.yaml
src-tauri/rules/network/dns.yaml
src-tauri/rules/network/ip.yaml
src-tauri/rules/personal/cardNum.yaml
src-tauri/rules/personal/email.yaml
src-tauri/rules/personal/phone.yaml
src-tauri/rules/rulesTemp.md
src-tauri/src/clipboard.rs
src-tauri/src/commands.rs
src-tauri/src/config.rs
src-tauri/src/engine.rs
src-tauri/src/lib.rs
src-tauri/src/main.rs
src-tauri/src/processor.rs
src-tauri/src/state.rs
src-tauri/tauri.conf.json
src-tauri/tauri.conf.json.md
src/App.vue
src/components/FileProcessor.vue
src/components/Sidebar.vue
src/components/StatCard.vue
src/main.ts
src/READMD.md
src/services/api.ts
src/stores/useAppStore.ts
src/style.css
tailwind.config.js
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="src-tauri/build.rs">
fn main() {
    tauri_build::build()
}
</file>

<file path="src-tauri/custom/internal.yaml">
group: "MY_INFO"
rules:
  - name: "MY_NAME"
    # ç®€åŒ–äº†é€»è¾‘ï¼Œé‡ç‚¹åœ¨äºåŒ¹é… @ å’ŒåŸŸå
    pattern: 'xiaosheng'
    mask: "<MY_NAME>"
    priority: 30 # è¾ƒé«˜ä¼˜å…ˆçº§
</file>

<file path="src-tauri/custom/private.yaml">

</file>

<file path="src-tauri/rules/auth/ai/keys.yaml">
group: "SENSITIVE_INFO"
rules:
  # --- AI API KEYS (å»æ‰äº†é”šç‚¹ï¼Œå¢åŠ äº†è¾¹ç•Œåˆ¤å®š) ---
  - name: "OpenAI"
    pattern: '\bsk-[a-zA-Z0-9\-]{32,}\b' # é€‚é… sk-proj åŠé•¿ key
    mask: "<OPENAI_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§
  
  - name: "Anthropic_Claude"
    pattern: '\bsk-ant-api03-[a-zA-Z0-9\-_]{90,100}AA\b'
    mask: "<CLAUDE_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§

  - name: "Google_Gemini"
    pattern: '\bAIzaSy[a-zA-Z0-9\-_]{33}\b'
    mask: "<GEMINI_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§

  - name: "DeepSeek"
    pattern: '\bsk-[a-z0-9]{32}\b'
    mask: "<DEEPSEEK_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§
</file>

<file path="src-tauri/rules/auth/database/urls.yaml">
group: "DATABASE_CONNECTION"
rules:
  - name: "PostgreSQL_URI"
    # ç§»é™¤äº† ^ å’Œ $ï¼Œä½¿ç”¨ \b (è¯è¾¹ç•Œ) å¹¶åœ¨æœ«å°¾ä½¿ç”¨æ’é™¤å­—ç¬¦é›†ï¼Œç¡®ä¿æŠ“å–åˆ°ç©ºç™½ç¬¦æˆ–å¼•å·ä¸ºæ­¢
    pattern: '\bpostgres(?:ql)?://[^\s''"<>]+'
    mask: "<POSTGRES_URI>"

  - name: "MySQL_URI"
    pattern: '\bmysql(?:\+.+)?://[^\s''"<>]+'
    mask: "<MYSQL_URI>"

  - name: "MongoDB_URI"
    pattern: '\bmongodb(?:\+srv)?://[^\s''"<>]+'
    mask: "<MONGODB_URI>"

  - name: "Redis_URI"
    pattern: '\brediss?://[^\s''"<>]+'
    mask: "<REDIS_URI>"

  - name: "SQLServer_URI"
    pattern: '\bsqlserver://[^\s''"<>]+'
    mask: "<SQLSERVER_URI>"

  - name: "Oracle_URI"
    pattern: '\boracle:thin:@[^\s''"<>]+'
    mask: "<ORACLE_URI>"

  - name: "SQLite_File"
    pattern: '\bsqlite(?:3)?://[^\s''"<>]+'
    mask: "<SQLITE_URI>"
</file>

<file path="src-tauri/rules/network/dns.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "FQDN_Domain"
    pattern: '\b[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}\b'
    mask: "<DOMAIN>"
    priority: 5 # æ™®é€šä¼˜å…ˆçº§
</file>

<file path="src-tauri/rules/network/ip.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "IPv4_Address"
    # å…¼é¡¾å‡†ç¡®æ€§ä¸æ€§èƒ½çš„å†™æ³•
    pattern: '\b(?:(?:25[0-5]|2[0-4]\d|1?\d{1,2})\.){3}(?:25[0-5]|2[0-4]\d|1?\d{1,2})\b'
    mask: "<IPv4>"
    priority: 60 # é«˜ä¼˜å…ˆçº§

  - name: "IPv6_Address"
    pattern: '\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b|\b(?:[0-9a-fA-F]{1,4}:){1,7}:|:[:0-9a-fA-F]{1,7}\b'
    mask: "<IPv6>"
    priority: 10
</file>

<file path="src-tauri/rules/personal/cardNum.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "China_ID_Card_18"
  # èº«ä»½è¯æœ«å°¾å¯èƒ½æ˜¯ Xï¼Œå‰åå¿…é¡»æ˜¯è¯è¾¹ç•Œé˜²æ­¢è¯¯åˆ‡é•¿æ•°å­—
    pattern: '\b[1-9]\d{5}(19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}(\d|X|x)\b'
    mask: "<CHINA_ID_CARD>"
    priority: 100 # æ›´é«˜ä¼˜å…ˆçº§
</file>

<file path="src-tauri/rules/personal/email.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "Email_Address"
    # ç®€åŒ–äº†é€»è¾‘ï¼Œé‡ç‚¹åœ¨äºåŒ¹é… @ å’ŒåŸŸå
    pattern: '\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b'
    mask: "<EMAIL>"
    priority: 30 # è¾ƒé«˜ä¼˜å…ˆçº§
</file>

<file path="src-tauri/rules/personal/phone.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "Global_Phone_E164"
    # å¢åŠ å¯¹ + å·çš„å€¾å‘æˆ–æ›´ä¸¥æ ¼çš„è¾¹ç•Œ
    pattern: '(?:\+|00)[1-9]\d{7,14}\b' 
    mask: "<GLOBAL_PHONE>"
    priority: 5

  - name: "China_Mobile_Phone"
    # å¢åŠ äº†è¾¹ç•Œåˆ¤å®šï¼Œé˜²æ­¢åŒ¹é…åˆ°æ—¶é—´æˆ³ä¸­çš„ä¸€æ®µæ•°å­—
    pattern: '\b1[3-9]\d{9}\b'
    mask: "<CHINA_MOBILE>"
    priority: 100 # æ›´é«˜ä¼˜å…ˆçº§
</file>

<file path="src-tauri/rules/rulesTemp.md">
ä¸ºäº†ä¿è¯ safemask çš„æè‡´æ€§èƒ½å’ŒåŒ¹é…å‡†ç¡®æ€§ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„èŒƒï¼š
1. æ­£åˆ™ç¼–å†™å‡†åˆ™ (Principles)
è„±æ•è€Œéæ ¡éªŒï¼šæˆ‘ä»¬çš„ç›®çš„æ˜¯é®ç›–éšç§ï¼Œä¸æ˜¯éªŒè¯æ•°æ®çš„åˆæ³•æ€§ã€‚å®å¯é”™æ€ï¼ˆé®ç›–èŒƒå›´ç¨å¤§ï¼‰ï¼Œä¸å¯æ¼è¿‡ã€‚ å¤æ‚çš„æ­£åˆ™ï¼ˆå¦‚ä¸¥æ ¼çš„ Email æ ¡éªŒï¼‰ä¼šæ˜¾è‘—é™ä½åŒ¹é…é€Ÿåº¦ã€‚
è¯è¾¹ç•Œä¼˜å…ˆï¼šå§‹ç»ˆåœ¨æ­£åˆ™ä¸¤ç«¯ä½¿ç”¨ \bã€‚è¿™èƒ½é˜²æ­¢æŠŠ ID_12345678901 ä¸­çš„æ•°å­—è¯¯è®¤ä¸ºæ‰‹æœºå·ã€‚
ç¦ç”¨é”šç‚¹ï¼šä¸¥ç¦åœ¨ rules ä¸­ä½¿ç”¨ ^ å’Œ $ï¼ˆé™¤éä½ ç¡®å®šè¦åŒ¹é…æ•´è¡Œï¼‰ã€‚
ç¦æ­¢ç¯è§†ï¼šRust regex åº“ä¸æ”¯æŒ (?!)ã€(?<=) ç­‰ã€‚å¦‚æœéœ€è¦æ’é™¤ï¼Œè¯·é€šè¿‡å­—ç¬¦é›† [^...] å®ç°ã€‚

group: "CATEGORY_NAME" # å¤§ç±»åç§°ï¼ˆå¦‚ AUTH, PII, NETWORKï¼‰
rules:
  - name: "Rule_Unique_Name" # è§„åˆ™æè¿°å
    # æ¨¡å¼å»ºè®®ï¼š
    # 1. ä½¿ç”¨å•å¼•å·åŒ…è£¹ï¼Œé˜²æ­¢ YAML è½¬ä¹‰å†²çª
    # 2. æ¨¡å¼å¼€å¤´ç»“å°¾å°½é‡ä½¿ç”¨ \b
    # 3. é¿å…è¿‡åº¦ä½¿ç”¨ (.*) ç­‰è´ªå©ªåŒ¹é…
    pattern: '\bPREFIX-[a-zA-Z0-9]{10,}\b'
    mask: "<LABEL>" # å»ºè®®ä½¿ç”¨å¤§å†™+å°–æ‹¬å·ï¼ŒAI è¯†åˆ«æ•ˆæœæœ€å¥½
</file>

<file path="src-tauri/src/clipboard.rs">
use clipboard_master::{ClipboardHandler, CallbackResult};
use arboard::{Clipboard, Error as ArboardError}; // é‡å‘½åä»¥é˜²å†²çª
use std::sync::{Arc, Mutex};
use crate::engine::MaskEngine;
use tauri::AppHandle;
use tauri::Emitter; // Tauri v2 

pub struct GlobalClipboardHandler {
    pub app_handle: AppHandle,
    pub engine: Arc<MaskEngine>,
    pub last_content: Arc<Mutex<String>>,
    pub is_enabled: Arc<Mutex<bool>>,
}

impl ClipboardHandler for GlobalClipboardHandler {
    /// å½“ç³»ç»Ÿå‰ªè´´æ¿å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒOS ä¼šå›è°ƒæ­¤æ–¹æ³•
    fn on_clipboard_change(&mut self) -> CallbackResult {
        // 1. æ£€æŸ¥è‡ªåŠ¨ç›‘æ§å¼€å…³æ˜¯å¦å¼€å¯
        if !*self.is_enabled.lock().unwrap() {
            return CallbackResult::Next;
        }

        let mut ctx = match Clipboard::new() {
            Ok(c) => c,
            Err(_) => return CallbackResult::Next,
        };
        
        // 2. å°è¯•è·å–æ–‡æœ¬ã€‚å¦‚æœå½“å‰å‰ªè´´æ¿æ˜¯å›¾ç‰‡ã€æ–‡ä»¶æˆ–ç©ºï¼Œget_text() ä¼šè¿”å› Err
        match ctx.get_text() {
            Ok(current_text) => {
                // 3. æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚æœæ–‡æœ¬è¶…çº§å·¨å¤§ï¼ˆä¾‹å¦‚è¶…è¿‡ 2MBï¼‰ï¼Œå»ºè®®è·³è¿‡è‡ªåŠ¨è„±æ•ï¼Œé˜²æ­¢ UI å¡æ­»
                // è¿™ç§å¤§æ•°æ®å»ºè®®å¼•å¯¼ç”¨æˆ·ä½¿ç”¨â€œæ–‡ä»¶æ¨¡å¼â€
                if current_text.len() > 2 * 1024 * 1024 {
                    return CallbackResult::Next;
                }

                let mut last = self.last_content.lock().unwrap();

                // 4. å…³é”®ï¼šé˜²éœ‡è¡æœºåˆ¶ï¼ˆé˜²æ­¢è„±æ•å†™å›æ“ä½œå†æ¬¡è§¦å‘å˜åŠ¨äº‹ä»¶ï¼‰
                if current_text != *last && !current_text.is_empty() {
                    let masked_bytes = self.engine.mask_line(current_text.as_bytes());
                    let masked_text = String::from_utf8_lossy(&masked_bytes).into_owned();
                    // 5. åªæœ‰å†…å®¹çœŸæ­£å‘ç”Ÿè„±æ•æ›¿æ¢æ—¶æ‰æ‰§è¡Œæ“ä½œ
                    if masked_text != current_text {
                        *last = masked_text.clone();
                        // å°è¯•å†™å›è„±æ•åçš„æ–‡æœ¬
                        if let Ok(_) = ctx.set_text(masked_text) {
                            let _ = self.app_handle.emit("masked-event", "ğŸ›¡ï¸ éšç§å†…å®¹å·²è‡ªåŠ¨è„±æ•");
                        }
                    }
                }
            },
            // ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„ Arboard é”™è¯¯ç±»å‹
            Err(ArboardError::ContentNotAvailable) => {},
            Err(e) => eprintln!("å‰ªè´´æ¿å¤„ç†å¼‚å¸¸: {:?}", e),
        }
        CallbackResult::Next
    }

    fn on_clipboard_error(&mut self, error: std::io::Error) -> CallbackResult {
        eprintln!("å‰ªè´´æ¿ç›‘å¬æµå¼‚å¸¸: {}", error);
        CallbackResult::Next
    }
}
</file>

<file path="src-tauri/src/commands.rs">
use tauri::{State, AppHandle};
use crate::state::{AppState, ENGINE};
use crate::processor::FileProcessor;
use crate::config::RuleManager;

#[tauri::command]
pub async fn manual_mask_cmd() -> Result<String, String> {
    let mut ctx = arboard::Clipboard::new().map_err(|e| e.to_string())?;
    let text = ctx.get_text().map_err(|e| e.to_string())?;
    let masked = ENGINE.mask_line(text.as_bytes());
    let masked_text = String::from_utf8_lossy(&masked).into_owned();
    ctx.set_text(masked_text).map_err(|e| e.to_string())?;
    Ok("è„±æ•å·²æˆåŠŸ".into())
}

#[tauri::command]
pub async fn toggle_monitor(enabled: bool, state: State<'_, AppState>) -> Result<(), String> {
    let mut monitor = state.is_monitor_on.lock().unwrap();
    *monitor = enabled;
    Ok(())
}

#[tauri::command]
pub async fn process_file_gui(
    input_path: String,
    output_path: String,
    app_handle: AppHandle,
) -> Result<String, String> {
    FileProcessor::run_ordered_pipeline(input_path, output_path, app_handle)
}

#[tauri::command]
pub fn get_rules_stats() -> serde_json::Value {
    let rules = RuleManager::load_all_rules();
    serde_json::json!({
        "rule_count": rules.len(),
    })
}
</file>

<file path="src-tauri/src/config.rs">
use serde::Deserialize;
use std::path::{Path, PathBuf};
use walkdir::WalkDir;
use anyhow::{Result, Context};

#[derive(Debug, Deserialize, Clone)]
pub struct Rule {
    #[allow(dead_code)]
    pub name: String,
    pub pattern: String,
    pub mask: String,
    #[serde(default = "default_priority")] // å¦‚æœYAMLæ²¡å†™ä¼˜å…ˆçº§ï¼Œåˆ™é»˜è®¤ä¸º0
    pub priority: i32,
}

fn default_priority() -> i32 { 0 }

#[derive(Debug, Deserialize, Clone)]
pub struct RuleGroup {
    #[allow(dead_code)]
    #[serde(default)]
    pub group: String,
    pub rules: Vec<Rule>,
}

pub struct RuleManager;


impl RuleManager {
    /// æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨åŠ è½½å†…ç½®è§„åˆ™ç›®å½•å’Œç”¨æˆ·è‡ªå®šä¹‰ç›®å½•
    pub fn load_all_rules() -> Vec<Rule> {
        let mut all_rules = Vec::new();
        
        // è§„å®šä¸¤ä¸ªåŠ è½½è·¯å¾„
        let paths = vec![
            PathBuf::from("rules"),  // å†…ç½®ç›®å½•
            PathBuf::from("custom"), // ç”¨æˆ·è‡ªå®šä¹‰ç›®å½•
        ];

        for path in paths {
            if path.exists() && path.is_dir() {
                all_rules.extend(Self::load_from_directory(path));
            }
        }
        all_rules
    }

    fn load_from_directory<P: AsRef<Path>>(dir: P) -> Vec<Rule> {
        let mut rules = Vec::new();
        for entry in WalkDir::new(dir).into_iter().filter_map(|e| e.ok()) {
            if entry.path().extension().map_or(false, |ext| ext == "yaml") {
                if let Ok(file_rules) = Self::parse_file(entry.path()) {
                    rules.extend(file_rules);
                }
            }
        }
        rules
    }

    fn parse_file(path: &Path) -> Result<Vec<Rule>> {
        let content = std::fs::read_to_string(path)?;
        let group: RuleGroup = serde_yaml::from_str(&content)
            .with_context(|| format!("è§£æè§„åˆ™æ–‡ä»¶å¤±è´¥: {:?}", path))?;
        Ok(group.rules)
    }
}
</file>

<file path="src-tauri/src/engine.rs">
use crate::config::Rule;
use regex::bytes::{Captures, Regex};
use std::borrow::Cow;
use aho_corasick::{AhoCorasick, MatchKind};

/// è§„åˆ™å±‚çº§ï¼šç”¨äºå­˜å‚¨ç¼–è¯‘åçš„æ­£åˆ™åŠå…¶å¯¹åº”çš„åç§»é‡
struct RegexLayer {
    re: Regex,
    masks: Vec<Vec<u8>>,
    offsets: Vec<usize>,
}

pub struct MaskEngine {
    // å±‚çº§ 1: AC å¼•æ“ (å›ºå®šè¯ï¼Œå¤„ç† O(1) åŒ¹é…)
    ac_engine: Option<AhoCorasick>,
    ac_masks: Vec<Vec<u8>>,

    // å±‚çº§ 2 & 3: ä¼˜å…ˆçº§æ­£åˆ™å¼•æ“
    high_layer: Option<RegexLayer>,
    low_layer: Option<RegexLayer>,
}

impl MaskEngine {
     /// æ„é€ å‡½æ•°ï¼šæ‰§è¡Œè§„åˆ™åˆ†ç±»ã€ä¼˜å…ˆçº§æ’åºã€æ•è·ç»„è®¡ç®—åŠå¼•æ“ç¼–è¯‘
    pub fn new(mut rules: Vec<Rule>) -> Self {
        
        // 1. ä¼˜å…ˆçº§é™åºæ’åºï¼šé«˜ä¼˜å…ˆçº§åœ¨å·¦ä¾§ï¼Œç¬¦åˆæ­£åˆ™å¼•æ“åŒ¹é…åå¥½
        rules.sort_by(|a, b| b.priority.cmp(&a.priority).then_with(|| a.name.cmp(&b.name)));

        let mut ac_p = Vec::new(); let mut ac_m = Vec::new();
        let mut hr_p = Vec::new(); let mut hr_m = Vec::new();
        let mut lr_p = Vec::new(); let mut lr_m = Vec::new();
        
        for rule in rules {
            if is_literal(&rule.pattern) {
                ac_p.push(rule.pattern);
                ac_m.push(rule.mask.as_bytes().to_vec());
            } else if rule.priority > 5 {
                hr_p.push(format!("({})", rule.pattern));
                hr_m.push(rule.mask.as_bytes().to_vec());
            } else {
                lr_p.push(format!("({})", rule.pattern));
                lr_m.push(rule.mask.as_bytes().to_vec());
            }
        }
        
        Self {
            ac_engine: if ac_p.is_empty() { None } else {
                Some(AhoCorasick::builder()
                    .match_kind(MatchKind::LeftmostLongest)
                    .build(ac_p).expect("AC å¼•æ“æ„å»ºå¤±è´¥"))
            },
            ac_masks: ac_m,
            high_layer: Self::compile_layer(hr_p, hr_m),
            low_layer: Self::compile_layer(lr_p, lr_m),
        }
    }

     /// ç¼–è¯‘æ­£åˆ™å±‚ï¼Œå¹¶è®¡ç®—æ¯ä¸ªè§„åˆ™çš„æ•è·ç»„èµ·å§‹ç´¢å¼•
    fn compile_layer(patterns: Vec<String>, masks: Vec<Vec<u8>>) -> Option<RegexLayer> {
        if patterns.is_empty() { return None; }

        let mut offsets = Vec::new();
        let mut current_offset = 1; // 0 æ˜¯æ•´ä¸ªåŒ¹é…é¡¹ï¼Œç¬¬ä¸€ä¸ªè§„åˆ™ä» 1 å¼€å§‹

        for p in &patterns {
            let temp_re = Regex::new(p).expect("æ­£åˆ™è¯­æ³•é”™è¯¯");
            offsets.push(current_offset);
            // temp_re å·²ç»æ˜¯ "(pattern)" å½¢å¼
            // å®ƒåœ¨æ•´ä½“æ­£åˆ™ä¸­å ç”¨çš„ç»„æ•°å°±æ˜¯å®ƒçš„ captures_len() - 1
            // ä½†ç”±äº joined æ˜¯ "(p1)|(p2)"ï¼Œæ¯ä¸€ç»„å…¶å®åªå ç”¨äº†åŸæœ¬çš„ç»„ç©ºé—´
            current_offset += temp_re.captures_len() - 1; // åŠ¨æ€è®¡ç®—è¯¥è§„åˆ™å ç”¨çš„ç»„æ•°é‡
        }

        let combined_re = Regex::new(&patterns.join("|")).expect("è¶…çº§æ­£åˆ™èšåˆå¤±è´¥");

        Some(RegexLayer {
            re: combined_re,
            masks,
            offsets,
        })
    }

    /// æ‰§è¡Œè„±æ•æµç¨‹ï¼šAC -> High Priority Regex -> Low Priority Regex
    pub fn mask_line<'a>(&self, input: &'a [u8]) -> Cow<'a, [u8]> {
        // ç¬¬ä¸€é˜¶æ®µ: AC å¼•æ“
        let mut result = if let Some(ref ac) = self.ac_engine {
            Cow::Owned(ac.replace_all_bytes(input, &self.ac_masks))
        } else {
            Cow::Borrowed(input)
        };

        // ç¬¬äºŒé˜¶æ®µ: é«˜ä¼˜å…ˆçº§æ­£åˆ™
        if let Some(ref layer) = self.high_layer {
            let next = layer.re.replace_all(&result, |caps: &Captures| {
                self.dispatch(layer, caps)
            });
            // å…³é”®ï¼šå¦‚æœå‘ç”Ÿäº†æ›¿æ¢ï¼ˆOwnedï¼‰ï¼Œè½¬ç§»æ‰€æœ‰æƒï¼›å¦åˆ™ä¿æŒåŸæ ·ï¼ˆç»´æŒ 'a ç”Ÿå‘½å‘¨æœŸï¼‰
            result = match next {
                Cow::Owned(v) => Cow::Owned(v),
                Cow::Borrowed(_) => result,
            };
        }

        // ç¬¬ä¸‰é˜¶æ®µ: ä½ä¼˜å…ˆçº§æ­£åˆ™
        if let Some(ref layer) = self.low_layer {
            let next = layer.re.replace_all(&result, |caps: &Captures| {
                self.dispatch(layer, caps)
            });
            result = match next {
                Cow::Owned(v) => Cow::Owned(v),
                Cow::Borrowed(_) => result,
            };
        }
        result
    }

    fn dispatch(&self, layer: &RegexLayer, caps: &Captures) -> Vec<u8> {
        for (i, &offset) in layer.offsets.iter().enumerate() {
            if caps.get(offset).is_some() {
                return layer.masks[i].clone();
            }
        }
        b"<MASKED>".to_vec()
    }  
}

/// ç®€å•çš„è¾…åŠ©å‡½æ•°ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºçº¯æ–‡æœ¬ï¼ˆæ— æ­£åˆ™ç‰¹æ®Šç¬¦å·ï¼‰
fn is_literal(pattern: &str) -> bool {
    let specials = [
        '.', '+', '*', '?', '(', ')', '[', ']', '{', '}', '|', '^', '$', '\\',
    ];
    !pattern.chars().any(|c| specials.contains(&c))
}
</file>

<file path="src-tauri/src/lib.rs">
// Learn more about Tauri commands at https://tauri.app/develop/calling-rust/
#[tauri::command]
fn greet(name: &str) -> String {
    format!("Hello, {}! You've been greeted from Rust!", name)
}

#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_opener::init())
        .invoke_handler(tauri::generate_handler![greet])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
</file>

<file path="src-tauri/src/processor.rs">
use std::collections::BTreeMap;
use std::io::{BufWriter, Write};
use std::fs::File;
use tauri::{AppHandle, Emitter};
use crate::state::{ProgressPayload, ENGINE, MACRO_CHUNK_SIZE, BUFFER_SIZE};
use rayon::prelude::*;

pub struct FileProcessor;

impl FileProcessor {
    /// æ‰§è¡Œä¿åºè„±æ•æµæ°´çº¿
    pub fn run_ordered_pipeline(
        input_path: String,
        output_path: String,
        app_handle: AppHandle,
    ) -> Result<String, String> {
        let file = File::open(&input_path).map_err(|e| e.to_string())?;
        let mmap = unsafe { memmap2::Mmap::map(&file).map_err(|e| e.to_string())? };
        let file_size = mmap.len();
        let total_chunks = (file_size as f32 / MACRO_CHUNK_SIZE as f32).ceil() as usize;

        let (tx, rx) = crossbeam_channel::bounded::<(usize, Vec<u8>)>(rayon::current_num_threads() * 2);

        // é¡ºåºå†™å…¥çº¿ç¨‹
        let writer_handle = std::thread::spawn(move || -> Result<(), String> {
            let file_out = File::create(&output_path).map_err(|e| e.to_string())?;
            let mut writer = BufWriter::with_capacity(BUFFER_SIZE, file_out);
            let mut next_idx = 0;
            let mut pending_map = BTreeMap::new();
            let mut processed_count = 0;

            while let Ok((idx, data)) = rx.recv() {
                pending_map.insert(idx, data);
                while let Some(data) = pending_map.remove(&next_idx) {
                    writer.write_all(&data).map_err(|e| e.to_string())?;
                    next_idx += 1;
                    processed_count += 1;
                    
                    let _ = app_handle.emit("file-progress", ProgressPayload {
                        percentage: (processed_count as f32 / total_chunks as f32) * 100.0,
                        processed_mb: (processed_count * MACRO_CHUNK_SIZE) as f64 / 1024.0 / 1024.0,
                    });
                }
            }
            writer.flush().map_err(|e| e.to_string())?;
            Ok(())
        });

        // å¹¶è¡Œè®¡ç®—
        mmap.par_chunks(MACRO_CHUNK_SIZE)
            .enumerate()
            .for_each(|(idx, chunk)| {
                let mut out = Vec::with_capacity(chunk.len() + 2048);
                for line in chunk.split(|&b| b == b'\n') {
                    if !line.is_empty() {
                        out.extend_from_slice(&ENGINE.mask_line(line));
                    }
                    out.push(b'\n');
                }
                let _ = tx.send((idx, out));
            });

        drop(tx);
        writer_handle.join().map_err(|_| "Writer thread panicked")??;
        Ok("æ–‡ä»¶å¤„ç†æˆåŠŸ".into())
    }
}
</file>

<file path="src-tauri/src/state.rs">
use std::sync::{Arc, Mutex};
use once_cell::sync::Lazy;
use crate::engine::MaskEngine;
use crate::config::RuleManager;

// å¸¸é‡é…ç½®æŠ½å–
pub const MACRO_CHUNK_SIZE: usize = 4 * 1024 * 1024; 
pub const BUFFER_SIZE: usize = 8 * 1024 * 1024;    

/// å…¨å±€é™æ€å¼•æ“å•ä¾‹
pub static ENGINE: Lazy<MaskEngine> = Lazy::new(|| {
    let rules = RuleManager::load_all_rules();
    MaskEngine::new(rules)
});

/// åº”ç”¨å…¨å±€çŠ¶æ€ç»“æ„ä½“
pub struct AppState {
    #[allow(dead_code)]
    pub engine: Arc<MaskEngine>,
    pub is_monitor_on: Arc<Mutex<bool>>,
    #[allow(dead_code)]
    pub last_content: Arc<Mutex<String>>,
}

/// è¿›åº¦è´Ÿè½½ç»“æ„ï¼ˆç”¨äºè·¨æ¨¡å—åºåˆ—åŒ–ï¼‰
#[derive(serde::Serialize, Clone)]
pub struct ProgressPayload {
    pub percentage: f32,
    pub processed_mb: f64,
}
</file>

<file path="src-tauri/tauri.conf.json.md">
ç”±äºä½ å·²ç»å°†å‰ç«¯å‡çº§åˆ°äº† **Vue 3 + Vite** æ¶æ„ï¼ŒåŸæœ‰çš„ `tauri.conf.json` éœ€è¦é’ˆå¯¹ **å¼€å‘æœåŠ¡å™¨åœ°å€**ã€**æ„å»ºäº§ç‰©è·¯å¾„** ä»¥åŠ **Tauri v2 çš„å®‰å…¨æƒé™ä½“ç³»** è¿›è¡Œå¤§å¹…åº¦ä¼˜åŒ–ã€‚

ä»¥ä¸‹æ˜¯ä¸ºä½ ä¼˜åŒ–åçš„å®Œæ•´ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿå®Œç¾é€‚é… Vite çš„å¼€å‘æµï¼Œå¹¶æå‡äº†æ¡Œé¢çš„äº¤äº’è´¨æ„Ÿã€‚

### ä¼˜åŒ–åçš„ `safemask/src-tauri/tauri.conf.json`

```json
{
  "$schema": "https://schema.tauri.app/config/2",
  "productName": "SafeMask",
  "version": "1.0.0",
  "identifier": "com.aitobyte.safemask",
  "build": {
    "beforeDevCommand": "npm run dev",
    "beforeBuildCommand": "npm run build",
    "devUrl": "http://localhost:5173",
    "frontendDist": "../dist"
  },
  "app": {
    "withGlobalTauri": true,
    "windows": [
      {
        "title": "SafeMask - æè‡´æ€§èƒ½éšç§è„±æ•æ§åˆ¶å°",
        "width": 1024,
        "height": 720,
        "minWidth": 800,
        "minHeight": 600,
        "resizable": true,
        "fullscreen": false,
        "center": true,
        "theme": "Dark"
      }
    ],
    "security": {
      "csp": null
    }
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ],
    "publisher": "AiToByte"
  },
  "plugins": {
    "opener": {
      "default": true
    },
    "dialog": {
      "default": true
    },
    "notification": {
      "default": true
    },
    "global-shortcut": {
      "default": true
    }
  }
}
```

---

### æ ¸å¿ƒæ”¹è¿›è¯´æ˜ï¼ˆé’ˆå¯¹ Vue 3 å‡çº§ï¼‰ï¼š

1.  **æ„å»ºæµç¨‹å¯¹é½ (`build` èŠ‚ç‚¹)**ï¼š
    *   **`beforeDevCommand`**: è®¾ç½®ä¸º `npm run dev`ã€‚å½“ä½ è¿è¡Œ `cargo tauri dev` æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®ä½ å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ã€‚
    *   **`devUrl`**: è®¾ç½®ä¸º `http://localhost:5173`ã€‚è¿™æ˜¯ Vite é»˜è®¤çš„é¢„è§ˆåœ°å€ï¼ŒTauri ä¼šå°† Webview æŒ‚è½½åˆ°è¯¥åœ°å€ã€‚
    *   **`frontendDist`**: ä¿®æ”¹ä¸º `../dist`ã€‚Vue 3 æ‰“åŒ…åçš„é»˜è®¤è¾“å‡ºç›®å½•æ˜¯ `dist` è€ŒéåŸæ¥çš„ `src`ã€‚

2.  **çª—ä½“è´¨æ„Ÿæå‡ (`windows` èŠ‚ç‚¹)**ï¼š
    *   **å°ºå¯¸è°ƒæ•´**: å°†é»˜è®¤å°ºå¯¸å¢å¤§åˆ° `1024x720`ï¼Œæ›´é€‚åˆå±•ç¤ºä»ªè¡¨ç›˜å’Œå¤æ‚çš„ç»Ÿè®¡å›¾è¡¨ã€‚
    *   **é™åˆ¶æœ€å°å°ºå¯¸**: è®¾ç½® `minWidth` å’Œ `minHeight`ï¼Œé˜²æ­¢ç”¨æˆ·ç¼©æ”¾çª—ä½“è¿‡å°å¯¼è‡´ Vue ç»„ä»¶å¸ƒå±€å´©åã€‚
    *   **ä¸»é¢˜é”å®š**: å¼ºåˆ¶ `Dark` ä¸»é¢˜ï¼Œç¡®ä¿ç•Œé¢å§‹ç»ˆç¬¦åˆä½ è®¾è®¡çš„æ·±è‰²å·¥ä¸šé£ã€‚

3.  **æ’ä»¶æ˜¾å¼å£°æ˜ (`plugins` èŠ‚ç‚¹)**ï¼š
    *   Tauri v2 è¦æ±‚åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯å¯¹åº”çš„æ’ä»¶ã€‚æˆ‘å·²ç»å¸®ä½ åŠ ä¸Šäº† `dialog`ï¼ˆæ–‡ä»¶é€‰æ‹©ï¼‰ã€`notification`ï¼ˆè„±æ•æˆåŠŸé€šçŸ¥ï¼‰å’Œ `global-shortcut`ï¼ˆçƒ­é”®åŠŸèƒ½ï¼‰ã€‚

---

### âš ï¸ å¿…é¡»é…å¥—æ‰§è¡Œçš„æ“ä½œ

åœ¨ Tauri v2 ä¸­ï¼Œä»…ä»…ä¿®æ”¹ `tauri.conf.json` è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œä½ è¿˜éœ€è¦ç¡®ä¿**æƒé™èƒ½åŠ›ï¼ˆCapabilitiesï¼‰**æ–‡ä»¶å·²åŒæ­¥æ›´æ–°ã€‚

è¯·æ£€æŸ¥ `safemask/src-tauri/capabilities/default.json`ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸‹æƒé™ï¼Œå¦åˆ™ Vue å‰ç«¯æ— æ³•è°ƒç”¨ Rust å‘½ä»¤ï¼š

```json
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Capability for the main window",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "opener:default",
    "dialog:allow-open",
    "notification:allow-notify",
    "global-shortcut:allow-is-registered",
    "global-shortcut:allow-register",
    "core:event:allow-listen",
    "core:event:allow-emit"
  ]
}
```

### æ¥ä¸‹æ¥å»ºè®®æ‰§è¡Œï¼š
1.  **æ¸…ç†ç¼“å­˜**ï¼š`cargo clean`ï¼ˆç‰¹åˆ«æ˜¯ä½ ä¿®æ”¹äº† `identifier` åï¼‰ã€‚
2.  **æ­£å¼è¿è¡Œ**ï¼š`npx tauri dev`ã€‚

ç°åœ¨çš„é…ç½®å·²ç»å®Œå…¨å·¥ç¨‹åŒ–ï¼Œè¶³ä»¥æ”¯æ’‘ä½ åç»­å¢åŠ çš„æ‰€æœ‰ Vue 3 åŠŸèƒ½ã€‚
</file>

<file path="src/App.vue">
<script setup lang="ts">
import { onMounted } from 'vue';
import { listen } from "@tauri-apps/api/event";
import { useAppStore } from './stores/useAppStore';
import Sidebar from './components/Sidebar.vue';
import StatCard from './components/StatCard.vue';
import FileProcessor from './components/FileProcessor.vue';

const store = useAppStore();

onMounted(async () => {
  // 1. åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
  await store.fetchStats();

  // 2. ç›‘å¬åç«¯å›ä¼ çš„è¿›åº¦äº‹ä»¶
  await listen<{ percentage: number }>("file-progress", (event) => {
    store.progress = event.payload.percentage;
  });

  // 3. ç›‘å¬è„±æ•é€šçŸ¥
  await listen("masked-event", (event) => {
    console.info("ğŸ›¡ï¸ SafeMask:", event.payload);
    // è¿™é‡Œå¯ä»¥é›†æˆæ›´é«˜çº§çš„ Toast ç»„ä»¶
  });
});
</script>

<template>
  <div class="flex h-screen bg-[#09090b] text-zinc-100 select-none overflow-hidden">
    <Sidebar />

    <main class="flex-1 p-12 flex flex-col max-w-6xl mx-auto w-full">
      <header class="flex justify-between items-center mb-12">
        <div>
          <h1 class="text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-zinc-500">
            SafeMask æ§åˆ¶å°
          </h1>
          <p class="text-zinc-500 mt-2 text-lg">å®æ—¶ä¿æŠ¤å‰ªè´´æ¿ä¸å¤§è§„æ¨¡æ—¥å¿—éšç§</p>
        </div>

        <!-- ç›‘æ§å¼€å…³ -->
        <div class="glass px-6 py-4 rounded-[2rem] flex items-center gap-4">
          <span class="text-sm font-semibold">è‡ªåŠ¨ä¿æŠ¤</span>
          <button 
            @click="store.toggleMonitor"
            class="w-12 h-6 rounded-full relative transition-colors duration-300"
            :class="store.isMonitorOn ? 'bg-blue-600' : 'bg-zinc-700'"
          >
            <div 
              class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-300"
              :class="{ 'translate-x-6': store.isMonitorOn }"
            ></div>
          </button>
        </div>
      </header>

      <!-- ç»Ÿè®¡æ  -->
      <div class="grid grid-cols-3 gap-8 mb-12">
        <StatCard title="å·²åŠ è½½è§„åˆ™" :value="store.ruleCount" />
        <StatCard title="å¼•æ“æ¶æ„" value="HYBRID" color="text-blue-400" />
        <StatCard title="å†…å­˜å ç”¨" value="LOW (MMAP)" color="text-emerald-400" />
      </div>

      <FileProcessor />
    </main>
  </div>
</template>

<style>
.glass {
  background: rgba(24, 24, 27, 0.8);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.08);
}
</style>
</file>

<file path="src/components/FileProcessor.vue">
<script setup lang="ts">
import { listen } from "@tauri-apps/api/event";
import { onMounted, onUnmounted } from "vue";
import { useAppStore } from "../stores/useAppStore";
import { MaskAPI } from "../services/api";

const store = useAppStore();

// å¤„ç†æ–‡ä»¶è„±æ•æ ¸å¿ƒé€»è¾‘
const startProcessing = async (path: string) => {
  if (!path) return;
  store.isProcessing = true;
  store.currentFileName = path.split(/[\\/]/).pop() || "";
  
  try {
    const outPath = `${path}.masked.log`;
    await MaskAPI.processFile(path, outPath);
  } catch (err) {
    console.error("å¤„ç†å¤±è´¥:", err);
  } finally {
    setTimeout(() => { store.isProcessing = false; store.progress = 0; }, 1000);
  }
};

// ç‚¹å‡»ä¸Šä¼ 
const handleBrowse = async () => {
  const selected = await MaskAPI.selectFile();
  if (selected && typeof selected === 'string') {
    await startProcessing(selected);
  }
};

let unlistenDrag: any;

onMounted(async () => {
  // ç›‘å¬ Tauri æ‹–æ‹½äº‹ä»¶
  unlistenDrag = await listen<{ paths: string[] }>("tauri://drag-drop", (event) => {
    const path = event.payload.paths[0];
    startProcessing(path);
  });
});

onUnmounted(() => { if (unlistenDrag) unlistenDrag(); });
</script>

<template>
  <div 
    @click="handleBrowse"
    class="flex-1 border-2 border-dashed border-zinc-800 rounded-[3rem] flex flex-col items-center justify-center transition-all duration-300 group hover:border-blue-500/50 cursor-pointer"
    :class="{ 'bg-blue-500/5 border-blue-500/50': store.isProcessing }"
  >
    <div v-if="!store.isProcessing" class="text-center group-hover:scale-105 transition-transform">
      <div class="text-6xl mb-6">ğŸ“‚</div>
      <h3 class="text-xl font-bold mb-2 text-zinc-200">æ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
      <p class="text-zinc-500 text-sm">æ”¯æŒå¤š GB çº§æ–‡ä»¶ï¼Œä¿æŒè¡Œåº 100% ä¸€è‡´</p>
    </div>

    <div v-else class="w-3/4 space-y-4 animate-in fade-in zoom-in duration-300">
      <div class="flex justify-between text-sm font-bold">
        <span class="text-blue-400 truncate max-w-xs">{{ store.currentFileName }}</span>
        <span class="font-mono">{{ Math.round(store.progress) }}%</span>
      </div>
      <div class="w-full bg-zinc-900 h-3 rounded-full overflow-hidden border border-zinc-800 p-[2px]">
        <div 
          class="bg-gradient-to-r from-blue-600 to-indigo-500 h-full rounded-full transition-all duration-300"
          :style="{ width: `${store.progress}%` }"
        ></div>
      </div>
      <p class="text-center text-xs text-zinc-500 animate-pulse">æ­£åœ¨è°ƒç”¨å¤šæ ¸ Rust å¼•æ“åŠ é€Ÿå¤„ç†...</p>
    </div>
  </div>
</template>
</file>

<file path="src/components/Sidebar.vue">
<script setup lang="ts">
import { ref } from 'vue';
import { Home, Library, Settings, ShieldCheck } from 'lucide-vue-next';

// å½“å‰æ¿€æ´»çš„èœå•é¡¹
const activeTab = ref('dashboard');

const menuItems = [
  { id: 'dashboard', icon: Home, label: 'ä»ªè¡¨ç›˜' },
  { id: 'rules', icon: Library, label: 'è§„åˆ™åº“' },
];
</script>

<template>
  <nav class="w-20 flex flex-col items-center py-8 bg-[#0c0c0e] border-r border-zinc-800/50 z-50">
    <!-- Logo åŒºåŸŸ -->
    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/20 mb-12 group cursor-pointer">
      <ShieldCheck class="text-white w-7 h-7 group-hover:scale-110 transition-transform" />
    </div>
    
    <!-- ä¸­é—´å¯¼èˆªé¡¹ -->
    <div class="flex flex-col gap-6 flex-1">
      <button 
        v-for="item in menuItems" 
        :key="item.id"
        @click="activeTab = item.id"
        :title="item.label"
        class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all duration-300 group relative"
        :class="activeTab === item.id ? 'bg-blue-600/10 text-blue-400 border border-blue-500/20' : 'text-zinc-500 hover:bg-zinc-800/50 hover:text-zinc-200'"
      >
        <component :is="item.icon" class="w-6 h-6" />
        
        <!-- æ´»åŠ¨çŠ¶æ€çš„å°æŒ‡ç¤ºæ¡ -->
        <div 
          v-if="activeTab === item.id" 
          class="absolute -left-4 w-1 h-6 bg-blue-500 rounded-r-full shadow-[0_0_8px_rgba(59,130,246,0.5)]"
        ></div>
      </button>
    </div>

    <!-- åº•éƒ¨è®¾ç½®é¡¹ -->
    <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-zinc-500 hover:bg-zinc-800/50 hover:text-zinc-200 transition-all">
      <Settings class="w-6 h-6" />
    </button>
  </nav>
</template>
</file>

<file path="src/components/StatCard.vue">
<script setup lang="ts">
interface Props {
  title: string;
  value: string | number;
  color?: string; // å¯é€‰çš„æ–‡å­—é¢œè‰²ç±»å
}

defineProps<Props>();
</script>

<template>
  <div class="glass p-8 rounded-[2.5rem] relative overflow-hidden group transition-all duration-500 hover:border-zinc-700">
    <!-- èƒŒæ™¯å¾®å…‰ç‰¹æ•ˆ -->
    <div class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/5 rounded-full blur-3xl group-hover:bg-blue-500/10 transition-colors"></div>
    
    <p class="text-zinc-500 text-xs uppercase tracking-[0.2em] mb-3 font-semibold">
      {{ title }}
    </p>
    
    <div class="flex items-baseline gap-2">
      <p 
        class="text-4xl font-bold font-mono tracking-tighter transition-all"
        :class="color || 'text-zinc-100'"
      >
        {{ value }}
      </p>
      
      <!-- å¦‚æœæ˜¯ ACTIVE çŠ¶æ€ï¼Œå¢åŠ ä¸€ä¸ªå°å‘¼å¸ç¯ -->
      <span v-if="value === 'HYBRID'" class="flex h-2 w-2 relative">
        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
        <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
      </span>
    </div>
  </div>
</template>

<style scoped>
.glass {
  background: rgba(18, 18, 23, 0.6);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.05);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
}
</style>
</file>

<file path="src/READMD.md">
å°†å‰ç«¯å‡çº§åˆ° **Vue 3 (Composition API)** æ˜¯éå¸¸æ˜æ™ºçš„é€‰æ‹©ã€‚å®ƒä¸ä»…èƒ½è®© UI é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œè¿˜èƒ½åˆ©ç”¨ Vue çš„å“åº”å¼ç³»ç»Ÿå®Œç¾å¯¹æ¥ Rust åç«¯çš„å¼‚æ­¥äº‹ä»¶ï¼ˆå¦‚è¿›åº¦å›ä¼ ï¼‰ã€‚

æˆ‘ä»¬å°†é‡‡ç”¨ **Vite + Vue 3 + Tailwind CSS + Pinia** çš„ç°ä»£æŠ€æœ¯æ ˆï¼Œå¹¶ä¿æŒä¸¥æ ¼çš„**æœåŠ¡å±‚ï¼ˆServiceï¼‰- çŠ¶æ€å±‚ï¼ˆStoreï¼‰- è§†å›¾å±‚ï¼ˆComponentï¼‰**åˆ†å±‚æ¶æ„ã€‚

---

### 1. æ¨èçš„ç›®å½•ç»“æ„
```text
safemask/src/
â”œâ”€â”€ main.ts             # å…¥å£æ–‡ä»¶
â”œâ”€â”€ App.vue             # æ ¹ç»„ä»¶ï¼ˆå¤„ç†å…¨å±€ç³»ç»Ÿç›‘å¬ï¼‰
â”œâ”€â”€ style.css           # å…¨å±€æ ·å¼ï¼ˆTailwind æŒ‡ä»¤ï¼‰
â”œâ”€â”€ services/           # ã€æœåŠ¡å±‚ã€‘å°è£…ä¸ Rust ç«¯çš„ invoke é€šä¿¡
â”‚   â””â”€â”€ api.ts
â”œâ”€â”€ stores/             # ã€çŠ¶æ€å±‚ã€‘Pinia ç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆå¼€å…³ã€è§„åˆ™æ•°ï¼‰
â”‚   â””â”€â”€ useAppStore.ts
â””â”€â”€ components/         # ã€ç»„ä»¶å±‚ã€‘å¯å¤ç”¨çš„ UI å•å…ƒ
    â”œâ”€â”€ Sidebar.vue
    â”œâ”€â”€ StatCard.vue
    â””â”€â”€ FileProcessor.vue
```

---

### 2. ä»£ç å®ç°

#### A. æœåŠ¡å±‚ï¼š`services/api.ts`
å°è£…åç«¯æŒ‡ä»¤ï¼Œå¢åŠ ç±»å‹æç¤ºã€‚

```typescript
import { invoke } from "@tauri-apps/api/core";
import { open } from "@tauri-apps/plugin-dialog";

export interface RuleStats {
  rule_count: number;
  group_count: number;
}

export const MaskAPI = {
  // è·å–è§„åˆ™ç»Ÿè®¡
  async getStats(): Promise<RuleStats> {
    return await invoke("get_rules_stats");
  },

  // åˆ‡æ¢ç›‘æ§å¼€å…³
  async toggleMonitor(enabled: boolean): Promise<void> {
    await invoke("toggle_monitor", { enabled });
  },

  // æ–‡ä»¶è„±æ•
  async processFile(inputPath: string, outputPath: string): Promise<string> {
    return await invoke("process_file_gui", { inputPath, outputPath });
  },

  // é€‰æ‹©æ–‡ä»¶
  async selectFile() {
    return await open({
      multiple: false,
      filters: [{ name: 'Log/Text', extensions: ['log', 'txt', 'csv', 'json'] }]
    });
  }
};
```

#### B. çŠ¶æ€å±‚ï¼š`stores/useAppStore.ts`
ä½¿ç”¨ Pinia ç®¡ç†å…¨å±€çŠ¶æ€ï¼Œå“åº”å¼å¤„ç†è„±æ•è¿›åº¦ã€‚

```typescript
import { defineStore } from 'pinia';
import { ref } from 'vue';
import { MaskAPI } from '../services/api';

export const useAppStore = defineStore('app', () => {
  const isMonitorOn = ref(true);
  const ruleCount = ref(0);
  const isProcessing = ref(false);
  const progress = ref(0);
  const currentFileName = ref("");

  // åˆå§‹åŒ–ç»Ÿè®¡
  const fetchStats = async () => {
    const stats = await MaskAPI.getStats();
    ruleCount.ref = stats.rule_count;
  };

  // åˆ‡æ¢ç›‘æ§
  const toggleMonitor = async () => {
    isMonitorOn.value = !isMonitorOn.value;
    await MaskAPI.toggleMonitor(isMonitorOn.value);
  };

  return { 
    isMonitorOn, ruleCount, isProcessing, 
    progress, currentFileName, fetchStats, toggleMonitor 
  };
});
```

#### C. ç»„ä»¶å±‚ï¼š`components/FileProcessor.vue`
å¤„ç†æ ¸å¿ƒçš„æ‹–æ‹½ä¸ç‚¹å‡»ä¸Šä¼ é€»è¾‘ã€‚

```vue
<script setup lang="ts">
import { listen } from "@tauri-apps/api/event";
import { onMounted, onUnmounted } from "vue";
import { useAppStore } from "../stores/useAppStore";
import { MaskAPI } from "../services/api";

const store = useAppStore();

// å¤„ç†æ–‡ä»¶è„±æ•æ ¸å¿ƒé€»è¾‘
const startProcessing = async (path: string) => {
  if (!path) return;
  store.isProcessing = true;
  store.currentFileName = path.split(/[\\/]/).pop() || "";
  
  try {
    const outPath = `${path}.masked.log`;
    await MaskAPI.processFile(path, outPath);
  } catch (err) {
    console.error("å¤„ç†å¤±è´¥:", err);
  } finally {
    setTimeout(() => { store.isProcessing = false; store.progress = 0; }, 1000);
  }
};

// ç‚¹å‡»ä¸Šä¼ 
const handleBrowse = async () => {
  const selected = await MaskAPI.selectFile();
  if (selected && typeof selected === 'string') {
    await startProcessing(selected);
  }
};

let unlistenDrag: any;

onMounted(async () => {
  // ç›‘å¬ Tauri æ‹–æ‹½äº‹ä»¶
  unlistenDrag = await listen<{ paths: string[] }>("tauri://drag-drop", (event) => {
    const path = event.payload.paths[0];
    startProcessing(path);
  });
});

onUnmounted(() => { if (unlistenDrag) unlistenDrag(); });
</script>

<template>
  <div 
    @click="handleBrowse"
    class="flex-1 border-2 border-dashed border-zinc-800 rounded-[3rem] flex flex-col items-center justify-center transition-all duration-300 group hover:border-blue-500/50 cursor-pointer"
    :class="{ 'bg-blue-500/5 border-blue-500/50': store.isProcessing }"
  >
    <div v-if="!store.isProcessing" class="text-center group-hover:scale-105 transition-transform">
      <div class="text-6xl mb-6">ğŸ“‚</div>
      <h3 class="text-xl font-bold mb-2 text-zinc-200">æ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
      <p class="text-zinc-500 text-sm">æ”¯æŒå¤š GB çº§æ–‡ä»¶ï¼Œä¿æŒè¡Œåº 100% ä¸€è‡´</p>
    </div>

    <div v-else class="w-3/4 space-y-4 animate-in fade-in zoom-in duration-300">
      <div class="flex justify-between text-sm font-bold">
        <span class="text-blue-400 truncate max-w-xs">{{ store.currentFileName }}</span>
        <span class="font-mono">{{ Math.round(store.progress) }}%</span>
      </div>
      <div class="w-full bg-zinc-900 h-3 rounded-full overflow-hidden border border-zinc-800 p-[2px]">
        <div 
          class="bg-gradient-to-r from-blue-600 to-indigo-500 h-full rounded-full transition-all duration-300"
          :style="{ width: `${store.progress}%` }"
        ></div>
      </div>
      <p class="text-center text-xs text-zinc-500 animate-pulse">æ­£åœ¨è°ƒç”¨å¤šæ ¸ Rust å¼•æ“åŠ é€Ÿå¤„ç†...</p>
    </div>
  </div>
</template>
```

#### D. æ ¹ç»„ä»¶ï¼š`App.vue`
è´Ÿè´£å…¨å±€å¸ƒå±€ä¸ç³»ç»Ÿçº§äº‹ä»¶ç›‘å¬ã€‚

```vue
<script setup lang="ts">
import { onMounted } from 'vue';
import { listen } from "@tauri-apps/api/event";
import { useAppStore } from './stores/useAppStore';
import Sidebar from './components/Sidebar.vue';
import StatCard from './components/StatCard.vue';
import FileProcessor from './components/FileProcessor.vue';

const store = useAppStore();

onMounted(async () => {
  // 1. åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
  await store.fetchStats();

  // 2. ç›‘å¬åç«¯å›ä¼ çš„è¿›åº¦äº‹ä»¶
  await listen<{ percentage: number }>("file-progress", (event) => {
    store.progress = event.payload.percentage;
  });

  // 3. ç›‘å¬è„±æ•é€šçŸ¥
  await listen("masked-event", (event) => {
    console.info("ğŸ›¡ï¸ SafeMask:", event.payload);
    // è¿™é‡Œå¯ä»¥é›†æˆæ›´é«˜çº§çš„ Toast ç»„ä»¶
  });
});
</script>

<template>
  <div class="flex h-screen bg-[#09090b] text-zinc-100 select-none overflow-hidden">
    <Sidebar />

    <main class="flex-1 p-12 flex flex-col max-w-6xl mx-auto w-full">
      <header class="flex justify-between items-center mb-12">
        <div>
          <h1 class="text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-zinc-500">
            SafeMask æ§åˆ¶å°
          </h1>
          <p class="text-zinc-500 mt-2 text-lg">å®æ—¶ä¿æŠ¤å‰ªè´´æ¿ä¸å¤§è§„æ¨¡æ—¥å¿—éšç§</p>
        </div>

        <!-- ç›‘æ§å¼€å…³ -->
        <div class="glass px-6 py-4 rounded-[2rem] flex items-center gap-4">
          <span class="text-sm font-semibold">è‡ªåŠ¨ä¿æŠ¤</span>
          <button 
            @click="store.toggleMonitor"
            class="w-12 h-6 rounded-full relative transition-colors duration-300"
            :class="store.isMonitorOn ? 'bg-blue-600' : 'bg-zinc-700'"
          >
            <div 
              class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-300"
              :class="{ 'translate-x-6': store.isMonitorOn }"
            ></div>
          </button>
        </div>
      </header>

      <!-- ç»Ÿè®¡æ  -->
      <div class="grid grid-cols-3 gap-8 mb-12">
        <StatCard title="å·²åŠ è½½è§„åˆ™" :value="store.ruleCount" />
        <StatCard title="å¼•æ“æ¶æ„" value="HYBRID" color="text-blue-400" />
        <StatCard title="å†…å­˜å ç”¨" value="LOW (MMAP)" color="text-emerald-400" />
      </div>

      <FileProcessor />
    </main>
  </div>
</template>

<style>
.glass {
  background: rgba(24, 24, 27, 0.8);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.08);
}
</style>
```

---

### 3. è¯¥æ–¹æ¡ˆçš„å‡çº§ç‚¹ï¼ˆé¢è¯•/ç®€å†åŠ åˆ†é¡¹ï¼‰ï¼š

1.  **å“åº”å¼çŠ¶æ€æµ**ï¼šåˆ©ç”¨ Pinia é›†ä¸­ç®¡ç† UI çŠ¶æ€ã€‚å½“ Rust åç«¯é€šè¿‡ `emit` å‘é€ `file-progress` æ—¶ï¼ŒStore ä¼šè‡ªåŠ¨æ•è·å¹¶æ›´æ–°è¿›åº¦æ¡ï¼Œå®ç°äº†**æ•°æ®é©±åŠ¨ UI** çš„æœ€ä½³å®è·µã€‚
2.  **å¼‚æ­¥é€šä¿¡å¢å¼º**ï¼šæ‰€æœ‰åç«¯è°ƒç”¨éƒ½å°è£…åœ¨ `MaskAPI` æœåŠ¡ä¸­ï¼Œæ”¯æŒ Promise å¼‚æ­¥å¤„ç†ï¼Œé¿å…äº† UI çº¿ç¨‹é˜»å¡ã€‚
3.  **ç±»å‹å®‰å…¨ (TypeScript)**ï¼šåœ¨ Vue ç»„ä»¶ä¸ Rust äº¤äº’é—´å®šä¹‰äº†æ˜ç¡®çš„ `interface`ï¼Œå¤§å¹…é™ä½äº†ç”±äºåç«¯å­—æ®µå˜æ›´å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ã€‚
4.  **ç»„ä»¶åŒ–è§£è€¦**ï¼šä¾§è¾¹æ ã€ç»Ÿè®¡å¡ç‰‡ã€æ–‡ä»¶å¤„ç†å™¨å„å¸å…¶èŒï¼ŒåæœŸå¦‚æœå¢åŠ â€œè§„åˆ™é…ç½®é¡µé¢â€ï¼Œåªéœ€åœ¨ `views/` ä¸‹æ–°å»ºé¡µé¢å¹¶é…ç½®è·¯ç”±å³å¯ã€‚

### 4. æ“ä½œå»ºè®®ï¼š
1.  **åˆå§‹åŒ– Vite**ï¼šå¦‚æœä½ ä¹‹å‰æ²¡è£… Vueï¼Œåœ¨ `safemask` ç›®å½•ä¸‹è¿è¡Œ `npm install vue pinia lucide-vue-next`ã€‚
2.  **é…ç½® Tailwind**ï¼šç¡®ä¿ `tailwind.config.js` åŒ…å«æ–°åˆ›å»ºçš„ `.vue` æ–‡ä»¶è·¯å¾„ã€‚
3.  **è¿è¡Œ**ï¼š`npm run tauri dev`ã€‚

è¿™å¥— Vue 3 æ¶æ„å°†è®©ä½ çš„ **SafeMask** ä»ä¸€ä¸ªç®€å•çš„å·¥å…·è½¬å˜ä¸ºä¸€ä¸ªå…·æœ‰**äº’è”ç½‘å¤§å‚è´¨æ„Ÿ**çš„æ¡Œé¢æ¡Œé¢åº”ç”¨ã€‚
</file>

<file path="src/services/api.ts">
import { invoke } from "@tauri-apps/api/core";
import { open } from "@tauri-apps/plugin-dialog";

export interface RuleStats {
  rule_count: number;
  group_count: number;
}

export const MaskAPI = {
  // è·å–è§„åˆ™ç»Ÿè®¡
  async getStats(): Promise<RuleStats> {
    return await invoke("get_rules_stats");
  },

  // åˆ‡æ¢ç›‘æ§å¼€å…³
  async toggleMonitor(enabled: boolean): Promise<void> {
    await invoke("toggle_monitor", { enabled });
  },

  // æ–‡ä»¶è„±æ•
  async processFile(inputPath: string, outputPath: string): Promise<string> {
    return await invoke("process_file_gui", { inputPath, outputPath });
  },

  // é€‰æ‹©æ–‡ä»¶
  async selectFile() {
    return await open({
      multiple: false,
      filters: [{ name: 'Log/Text', extensions: ['log', 'txt', 'csv', 'json'] }]
    });
  }
};
</file>

<file path="src/style.css">

</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        // å®šä¹‰ç¬¦åˆéšç§å·¥å…·æ°”è´¨çš„æ·±è‰²ç³»
        background: "#09090b",
        secondary: "#121217",
        accent: "#3b82f6",
      },
      animation: {
        // å¢åŠ ä¸€ä¸ªå¾®å¼±çš„å‘¼å¸ç¯åŠ¨ç”»ï¼Œç”¨äºâ€œå¼•æ“æ´»è·ƒâ€çŠ¶æ€
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      }
    },
  },
  plugins: [],
}
</file>

<file path="vite.config.ts">
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";

// https://vitejs.dev/config/
export default defineConfig(async () => ({
  plugins: [vue()],

  // Vite é€‰é¡¹å®šåˆ¶ï¼Œä¼˜åŒ– Tauri å¼€å‘ä½“éªŒ
  clearScreen: false,
  server: {
    host: "127.0.0.1", // å¼ºåˆ¶ä½¿ç”¨ IPv4 åœ°å€
    port: 5173,
    strictPort: true,
    watch: {
      // å‘Šè¯‰ Vite å¿½ç•¥ç›‘å¬ src-tauri æ–‡ä»¶å¤¹ï¼Œé¿å…å¾ªç¯è§¦å‘é‡ç»˜
      ignored: ["**/src-tauri/**"],
    },
  },
}));
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2026 xiao sheng

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="src-tauri/capabilities/default.json">
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Capability for the main window",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "opener:default",
    "dialog:allow-open",
    "notification:allow-notify",
    "global-shortcut:allow-is-registered",
    "global-shortcut:allow-register",
    "core:event:allow-listen",
    "core:event:allow-emit"
  ]
}
</file>

<file path="src-tauri/Cargo.toml">
[package]
name = "SafeMask"
version = "1.0.0"
edition = "2024" # 2024æœ€æ–°ç‰ˆè¯­æ³•è§„èŒƒ
authors = ["xiaosheng <xiaosheng.tech@outlook.com>"]
description = "A high-performance, ordered data masking tool written in Rust."
license = "MIT"
readme = "README.md"
repository = "https://github.com/AiToByte/SafeMask.git"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[lib]
# The `_lib` suffix may seem redundant but it is necessary
# to make the lib name unique and wouldn't conflict with the bin name.
# This seems to be only an issue on Windows, see https://github.com/rust-lang/cargo/issues/8519
name = "safemask_lib"
crate-type = ["staticlib", "cdylib", "rlib"]

[build-dependencies]
tauri-build = { version = "2", features = [] }

[dependencies]
# åŸæœ‰æ ¸å¿ƒ
aho-corasick = "1.1.4"
regex = "1.12.2"
rayon = "1.11.0"
memmap2 = "0.9.9"
serde = { version = "1.0", features = ["derive"] }
serde_yaml = "0.9"
walkdir = "2.4"
mimalloc = "0.1"
once_cell = "1.21.3"
anyhow = "1.0"
arboard = "3.6.1"
crossbeam-channel = "0.5"
# æ–¹æ¡ˆä¸€ï¼šåŸç”Ÿäº‹ä»¶é©±åŠ¨å‰ªè´´æ¿ç›‘å¬
clipboard-master = "4.0.0"


# Tauri å¢å¼º
tokio = { version = "1", features = ["full"] }
tauri = { version = "2.1.1", features = [] }
tauri-plugin-opener = "2.2.5"
serde_json = "1.0"
tauri-plugin-dialog = "2.6.0"

[target.'cfg(not(any(target_os = "android", target_os = "ios")))'.dependencies]
tauri-plugin-global-shortcut = "2.2.0"
tauri-plugin-notification = "2.2.1"  # åŒä¸Š
</file>

<file path="src-tauri/src/main.rs">
// Prevents additional console window on Windows in release, DO NOT REMOVE!!
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

mod engine;
mod config;
mod clipboard;
mod state;
mod commands;
mod processor;

use std::sync::{Arc, Mutex};
// ä¿®å¤æ ¸å¿ƒï¼šæ˜¾å¼å¯¼å…¥ Emitter Trait
use tauri::{Emitter}; 
use tauri_plugin_global_shortcut::{GlobalShortcutExt, Shortcut, Modifiers, Code, Builder as ShortcutBuilder};

use crate::state::{AppState};
use crate::clipboard::GlobalClipboardHandler;
use crate::engine::MaskEngine;

#[global_allocator]
static GLOBAL: mimalloc::MiMalloc = mimalloc::MiMalloc;

fn main() {
    // 1. å‡†å¤‡å…¨å±€çŠ¶æ€
    let is_monitor_on = Arc::new(Mutex::new(true));
    let last_content = Arc::new(Mutex::new(String::new()));

    // 2. å¯åŠ¨å¹¶æ„å»ºåº”ç”¨
    tauri::Builder::default()
        .plugin(ShortcutBuilder::new()
            .with_handler(move |app, s, _event| {
                // çƒ­é”®é€»è¾‘ï¼šAlt + Shift + S
                if s.matches(Modifiers::ALT | Modifiers::SHIFT, Code::KeyS) {
                    tauri::async_runtime::block_on(commands::manual_mask_cmd()).ok();
                    let _ = app.emit("masked-event", "ğŸš€ çƒ­é”®è§¦å‘ï¼šéšç§å·²æ¸…æ´—");
                }
            })
            .build()
        )
        .plugin(tauri_plugin_notification::init())
        .manage(AppState {
            engine: Arc::new(MaskEngine::new(vec![])), // å ä½ï¼Œå®é™…é€»è¾‘é€šè¿‡ Lazy ENGINE
            is_monitor_on: is_monitor_on.clone(),
            last_content: last_content.clone(),
        })
        .invoke_handler(tauri::generate_handler![
            commands::manual_mask_cmd,
            commands::toggle_monitor,
            commands::process_file_gui,
            commands::get_rules_stats
        ])
        .setup(move |app| {
            let handle = app.handle().clone();
            
            // æ–¹æ¡ˆä¸€ï¼šå¯åŠ¨ç³»ç»Ÿçº§åŸç”Ÿç›‘å¬çº¿ç¨‹
            let is_on = is_monitor_on.clone();
            let last_c = last_content.clone();
            std::thread::spawn(move || {
                let handler = GlobalClipboardHandler {
                    app_handle: handle,
                    engine: Arc::new(MaskEngine::new(crate::config::RuleManager::load_all_rules())),
                    last_content: last_c,
                    is_enabled: is_on,
                };
                clipboard_master::Master::new(handler)
                    .expect("Failed to create Master")
                    .run()
                    .expect("Clipboard listener failed");
            });

            // æ³¨å†Œå…¨å±€çƒ­é”®
            let shortcut = Shortcut::new(Some(Modifiers::ALT | Modifiers::SHIFT), Code::KeyS);
            app.global_shortcut().register(shortcut)?;

            Ok(())
        })
        .run(tauri::generate_context!())
        .expect("Tauri åº”ç”¨å¯åŠ¨å¤±è´¥");
}
</file>

<file path="src/main.ts">
/**
 * SafeMask Desktop - å‰ç«¯å…¥å£æ–‡ä»¶
 * è´Ÿè´£åˆå§‹åŒ– Vue 3 è¿è¡Œç¯å¢ƒã€Pinia çŠ¶æ€ç®¡ç†ä»¥åŠå…¨å±€æ ·å¼åŠ è½½
 */

import { createApp } from "vue";
import { createPinia } from "pinia";

// å¼•å…¥å…¨å±€æ ·å¼ï¼ˆåŒ…å« Tailwind CSS æŒ‡ä»¤ï¼‰
import "./style.css";

// å¼•å…¥æ ¹ç»„ä»¶
import App from "./App.vue";

/**
 * å¯åŠ¨åº”ç”¨é€»è¾‘
 */
async function bootstrap() {
  // 1. åˆ›å»º Vue åº”ç”¨å®ä¾‹
  const app = createApp(App);

  // 2. åˆ›å»ºå¹¶æŒ‚è½½ Pinia çŠ¶æ€ç®¡ç† (ç”¨äºè·¨ç»„ä»¶å…±äº«è„±æ•å¼€å…³ã€è§„åˆ™æ•°ç­‰)
  const pinia = createPinia();
  app.use(pinia);

  // 3. é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆå…¨å±€æ•è·ï¼Œå¢å¼º App é²æ£’æ€§ï¼‰
  app.config.errorHandler = (err, instance, info) => {
    console.error("Vue Global Error:", err);
    console.info("Error Info:", info);
    // æ­¤å¤„æœªæ¥å¯ä»¥é›†æˆ Tauri çš„æ—¥å¿—åº“ï¼Œå°†é”™è¯¯å†™å…¥æœ¬åœ°æ–‡ä»¶
  };

  // 4. æŒ‚è½½åˆ° index.html ä¸­çš„ #app èŠ‚ç‚¹
  app.mount("#app");

}

// å¯åŠ¨
bootstrap();
</file>

<file path="src/stores/useAppStore.ts">
import { defineStore } from 'pinia';
import { ref } from 'vue';
import { MaskAPI } from '../services/api';

export const useAppStore = defineStore('app', () => {
  const isMonitorOn = ref(true);
  const ruleCount = ref(0);
  const isProcessing = ref(false);
  const progress = ref(0);
  const currentFileName = ref("");

  // åˆå§‹åŒ–ç»Ÿè®¡
  const fetchStats = async () => {
    const stats = await MaskAPI.getStats();
    ruleCount.value = stats.rule_count;
  };

  // åˆ‡æ¢ç›‘æ§
  const toggleMonitor = async () => {
    isMonitorOn.value = !isMonitorOn.value;
    await MaskAPI.toggleMonitor(isMonitorOn.value);
  };

  return { 
    isMonitorOn, ruleCount, isProcessing, 
    progress, currentFileName, fetchStats, toggleMonitor 
  };
});
</file>

<file path="package.json">
{
  "name": "safemask",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview",
    "tauri": "tauri"
  },
  "dependencies": {
    "@tauri-apps/api": "^2.1.0",
    "@tauri-apps/plugin-dialog": "^2.0.0",
    "@tauri-apps/plugin-notification": "^2.0.0",
    "@tauri-apps/plugin-opener": "^2.0.0",
    "lucide-vue-next": "^0.471.0",
    "pinia": "^2.3.1",
    "vue": "^3.5.27"
  },
  "devDependencies": {
    "@tauri-apps/cli": "^2.1.0",
    "@vitejs/plugin-vue": "^5.2.1",
    "autoprefixer": "^10.4.20",
    "postcss": "^8.4.49",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.7.2",
    "vite": "^6.0.7",
    "vue-tsc": "^2.2.0"
  }
}
</file>

<file path="src-tauri/tauri.conf.json">
{
  "$schema": "https://schema.tauri.app/config/2",
  "productName": "SafeMask",
  "version": "1.0.0",
  "identifier": "com.aitobyte.safemask",
  "build": {
    "beforeDevCommand": "npm run dev",
    "beforeBuildCommand": "npm run build",
    "devUrl": "http://127.0.0.1:5173",
    "frontendDist": "../dist"
  },
  "app": {
    "withGlobalTauri": true,
    "windows": [
      {
        "title": "SafeMask - æè‡´æ€§èƒ½éšç§è„±æ•æ§åˆ¶å°",
        "width": 1024,
        "height": 720,
        "minWidth": 800,
        "minHeight": 600,
        "resizable": true,
        "fullscreen": false,
        "center": true,
        "theme": "Dark"
      }
    ],
    "security": {
      "csp": null
    }
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ],
    "publisher": "AiToByte"
  },
  "plugins": {
    "opener": {
      "default": true
    }
  }
}
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

/target
/out
/test
repomix-output.xml
*/gen
</file>

<file path="Cargo.toml">
[workspace]
# æŒ‡å®šå·¥ä½œåŒºæˆå‘˜ï¼ŒåŒ…æ‹¬ä½ çš„æ¡Œé¢ç‰ˆé¡¹ç›®
members = [
    "src-tauri",
]
# ä½¿ç”¨æœ€æ–°çš„è§£æå™¨
resolver = "2"
</file>

<file path="README.md">
# SafeMask
Enabling every line of data to safely embrace AI.
After your content is processed by SafeMask, all private information will be anonymized, allowing your information to be safely transmitted and processed on the internet, by AI, etc.

---

# ğŸ›¡ï¸ SafeMask v0.4.2
[![Rust](https://img.shields.io/badge/language-Rust-orange.svg)](https://www.rust-lang.org/)
[![Performance](https://img.shields.io/badge/performance-300MB%2Fs+-green.svg)](#-performance-benchmarks)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)](#-installation)
[![AI-Friendly](https://img.shields.io/badge/AI-Friendly-brightgreen.svg)](#-ai-friendly-masking)

<div align="center">


 **ğŸ¤—ğŸ›¡ï¸ Enabling every line of data to safely embrace AI**

</div>

## ğŸ“¡ é¡¹ç›®åŠ¨æ€ (Project Roadmap)
| å½¢æ€ | åˆ†æ”¯ | çŠ¶æ€ | æ ¸å¿ƒèƒ½åŠ› |
| :--- | :--- | :--- | :--- |
| ğŸš **CLI å‘½ä»¤è¡Œ** | [`main-cmd`](https://github.com/AiToByte/safemask/tree/main-cmd) | **ç¨³å®šç‰ˆ (Stable)** | é«˜æ€§èƒ½æ–‡ä»¶è„±æ•ã€æ··åˆå¼•æ“ã€ä¿åºæµæ°´çº¿ |
| ğŸ–¥ï¸ **Desktop æ¡Œé¢** | `main` | **ç ”å‘ä¸­ (WIP)** | **Tauri é©±åŠ¨**ã€å‰ªè´´æ¿å®æ—¶ç›‘å¬ã€é™é»˜è„±æ•ã€å¯è§†åŒ–é…ç½® |


> **ğŸ“¢ ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š**
> å¦‚æœæ‚¨éœ€è¦å¤„ç†æœ¬åœ°å¤§è§„æ¨¡æ—¥å¿—ï¼Œæˆ–æ‰‹åŠ¨æ¸…æ´—å‰ªè´´æ¿å†…å®¹ï¼Œè¯·ç‚¹å‡»åˆ‡æ¢è‡³ **[`main-cmd`](https://github.com/AiToByte/safemask/tree/main-cmd)** åˆ†æ”¯ã€‚


> **ğŸ§ª å®éªŒæ€§ç‰¹æ€§é¢„å‘Šï¼š**
> `main` åˆ†æ”¯æ­£åœ¨è¿›è¡Œ **SafeMask Desktop** çš„å°é—­å¼€å‘ã€‚æˆ‘ä»¬åˆ©ç”¨ **Tauri + Rust** çš„é«˜æ€§èƒ½æ¶æ„ï¼Œå®ç°å¯¹ç³»ç»Ÿå‰ªè´´æ¿çš„â€œæ— æ„Ÿç›‘æ§â€â€”â€”æ•æ„Ÿä¿¡æ¯åœ¨è¿›å…¥ AI å¯¹è¯æ¡†å‰å°†è¢«è‡ªåŠ¨æ‹¦æˆªå¹¶æ›¿æ¢ã€‚æ•¬è¯·æœŸå¾…ï¼

## âœ¨ v0.4.2 æ–°ç‰¹æ€§ï¼šçµæ´»å®šåˆ¶ï¼Œæè‡´æ€§èƒ½

*   **ğŸ—‚ï¸ æ³•å®šç›®å½•ç®¡ç†**ï¼šè‡ªåŠ¨æ‰«æ `rules/` (ç³»ç»Ÿå†…ç½®) ä¸ `custom/` (ç”¨æˆ·è‡ªå®šä¹‰) ç›®å½•ï¼Œè§„åˆ™å˜æ›´æ— éœ€é‡æ–°ç¼–è¯‘ã€‚
*   **ğŸš€ æ··åˆåŠ¨åŠ›å¼•æ“**ï¼š
    *   **å›ºå®šè¯è¿‡æ»¤**ï¼šè‡ªåŠ¨è¯†åˆ«çº¯æ–‡æœ¬è§„åˆ™ï¼ˆå¦‚äººåã€é¡¹ç›®åï¼‰ï¼Œé‡‡ç”¨ **Aho-Corasick** ç®—æ³•ï¼Œå®ç° $O(n)$ çº§æé€Ÿè¿‡æ»¤ã€‚
    *   **æ¨¡å¼åŒ¹é…**ï¼šå¤æ‚éšç§æ¨¡å¼é‡‡ç”¨ **é«˜æ€§èƒ½å­—èŠ‚æ­£åˆ™**ï¼Œåˆ†å±‚ä¼˜å…ˆçº§å¤„ç†ã€‚
*   **ğŸ§  AI å‹å¥½å‹è¯­ä¹‰**ï¼šæ”¯æŒå°†æ•æ„Ÿä¿¡æ¯æ›¿æ¢ä¸º `<EMAIL>`ã€`<PROJECT_ID>` ç­‰æ ‡ç­¾ï¼Œè€Œéç ´åæ€§çš„ `***`ã€‚


## ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© SafeMask?

åœ¨ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰æ—¶ä»£ï¼Œå°†æ—¥å¿—æˆ–ä»£ç ç›´æ¥ç²˜è´´ç»™ AI å¤„ç†å­˜åœ¨æé«˜çš„æ³„éœ²é£é™©ã€‚SafeMask è§£å†³äº†ä¸‰å¤§ç—›ç‚¹ï¼š

1.  **AI è¯­ä¹‰ä¿ç•™ (AI-Friendly)**ï¼šä¼ ç»Ÿçš„ `***` æ©ç ä¼šç ´å AI çš„ç†è§£èƒ½åŠ›ã€‚SafeMask ä½¿ç”¨ **è¯­ä¹‰åŒ–æ ‡ç­¾**ï¼ˆå¦‚ `<POSTGRES_URI>`ï¼‰ï¼Œè®© AI çŸ¥é“æ­¤å¤„æ˜¯ä¸€ä¸ªæ•°æ®åº“é“¾æ¥ï¼Œåœ¨ä¸æš´éœ²å¯†ç çš„å‰æä¸‹ä¿ç•™é€»è¾‘ä¸Šä¸‹æ–‡ã€‚
2.  **ç»å¯¹é›¶ä¿¡ä»» (Zero-Trust)**ï¼š100% æœ¬åœ°è¿è¡Œï¼Œä¸äº§ç”Ÿä»»ä½•å¤–ç½‘è¯·æ±‚ï¼Œç¡®ä¿æ•°æ®ä¸å‡ºæœ¬åœ°ã€‚
3.  **æè‡´æ€§èƒ½ (Industrial-Grade)**ï¼šåˆ©ç”¨ Rust çš„å¹¶è¡Œè®¡ç®—å’Œå†…å­˜æ˜ å°„æŠ€æœ¯ï¼Œå¤„ç† GB çº§æ—¥å¿—ä»…éœ€æ•°ç§’ï¼Œæ— æƒ§æµ·é‡æ•°æ®ã€‚
 

---



## ğŸš€ æ ¸å¿ƒæ¶æ„ï¼šä¸‰é˜¶æ®µä¿åºæµæ°´çº¿ (Level 3 Optimization)

SafeMask ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ­£åˆ™æ›¿æ¢å·¥å…·ï¼Œå®ƒé‡‡ç”¨äº†å¤æ‚çš„**ç”Ÿäº§è€…-æ¶ˆè´¹è€…æµæ°´çº¿**æ¨¡å‹ï¼Œå®ç°äº† **CPU è®¡ç®—ä¸ I/O è¯»å†™çš„å®Œå…¨é‡å ï¼ˆOverlappingï¼‰**ã€‚

### ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ
```text
[ åŸå§‹æ•°æ® ] 
     |
     v
( Stage 1: ç”Ÿäº§è€… ) â” å†…å­˜æ˜ å°„ (Mmap) + æ™ºèƒ½å®åˆ†å— (Macro-Chunking 4MB)
     |
     v
( Stage 2: è®¡ç®—é›†ç¾¤ ) â” Rayon å¹¶è¡Œå¤„ç† | å­—èŠ‚æµæ­£åˆ™å¼•æ“ | Aho-Corasick è‡ªåŠ¨æœº
     |
     v
( Stage 3: æ¶ˆè´¹è€… ) â” BTreeMap æ’åºç¼“å†²åŒº | ä¿åºåˆå¹¶ | 8MB èšåˆå†™å…¥ (BufWriter)
     |
     v
[ è„±æ•äº§ç‰© ]
```


### âš¡ æ·±åº¦ä¼˜åŒ–ç»†èŠ‚
- **Zero-Copy I/O**: ä½¿ç”¨ `memmap2` ç»•è¿‡å†…æ ¸ç¼“å†²åŒºæ‹·è´ã€‚
- **Byte-Level Engine**: åŸºäº `regex::bytes` å®ç°ï¼Œå®Œå…¨è·³è¿‡ UTF-8 æ ¡éªŒå¼€é”€ã€‚
- **Context-Aware**: æ™ºèƒ½è¯†åˆ« `sk-`ã€`postgres://` ç­‰ç‰¹å¾ï¼Œç²¾å‡†åŒºåˆ†éšç§ç±»å‹ã€‚
- **Ordered Pipelining**: ç¡®ä¿é«˜å¹¶å‘å¤„ç†åçš„è¾“å‡ºè¡Œåºä¸è¾“å…¥å®Œå…¨ä¸€è‡´ã€‚
- **Memory Reuse**: é‡‡ç”¨çº¿ç¨‹å±€éƒ¨ç¼“å†²åŒºï¼ˆScratch Buffersï¼‰ï¼Œå°†å†…å­˜åˆ†é…å‹åŠ›ä» $O(N)$ é™ä½åˆ° $O(Threads)$ã€‚

## ğŸ“Š æ€§èƒ½åŸºå‡† (Performance Benchmarks)
*æµ‹è¯•ç¯å¢ƒ: Windows 11 / i7-12700K / NVMe SSD*

| æ•°æ®è§„æ¨¡ | åŸå§‹å¤„ç†è€—æ—¶ (PS) | **SafeMask è€—æ—¶** | ååé‡ (Throughput) |
| :--- | :--- | :--- | :--- |
| **113 MB (100ä¸‡è¡Œ)** | 21.9s | **0.42s** | **~270 MB/s** |
| **1.2 GB (500ä¸‡è¡Œ)** | - | **4.1s** | **~300 MB/s** |
| **2.3 GB (1000ä¸‡è¡Œ)** | - | **8.3s** | **~337 MB/s** |

> *æ³¨ï¼šæ€§èƒ½å—é™äºç£ç›˜ I/O ä¸Šé™ã€‚*


## ğŸ¤– AI å‹å¥½å‹è„±æ•ç¤ºä¾‹ (AI-Friendly Masking)

### 3.1 åŸå§‹é£é™©æ•°æ®
> `INFO | User: admin | IP: 158.209.138.172 | DB: postgres://admin:p@ssw0rd123@10.0.0.5:5432/prod | Key: sk-ant-api03-xxxx...`

### 3.2 ä¼ ç»Ÿè„±æ• (AI éš¾ä»¥ç†è§£é€»è¾‘)
> `INFO | User: admin | IP: *.*.*.* | DB: *********** | Key: ***********`
> *AI åé¦ˆ: "ç”±äºä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œæˆ‘æ— æ³•åˆ†ææ‚¨çš„æ•°æ®åº“è¿æ¥é…ç½®..."*

### 3.3 SafeMask è„±æ• (è¯­ä¹‰åŒ–ä¿ç•™)
> `INFO | User: admin | IP: <IPv4> | DB: <POSTGRES_URI> | Key: <CLAUDE_KEY>`
> *AI åé¦ˆ: "æ‚¨çš„ **PostgreSQL** è¿æ¥é…ç½®çœ‹èµ·æ¥æ­£ç¡®ï¼Œä½†è¯·ç¡®ä¿ç«¯å£ **5432** åœ¨é˜²ç«å¢™ä¸­å·²å¼€æ”¾..."*

---


## ğŸ› ï¸ å®‰è£…ä¸ç¼–è¯‘

ç¡®ä¿å·²å®‰è£… Rust ç¯å¢ƒ (MSRV 1.70+)ã€‚

```bash
git clone https://github.com/AiToByte/safemask.git
cd safemask

# å¿…é¡»ä½¿ç”¨ --release æ¨¡å¼ä»¥å¼€å¯æ‰€æœ‰ç¼–è¯‘ä¼˜åŒ–
cargo build --release
```

ç¼–è¯‘äº§ç‰©ä½äº `./target/release/safemask`ã€‚

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. å‰ªè´´æ¿æ¨¡å¼
æœ€é€‚åˆåœ¨å°†ä»£ç æˆ–æ—¥å¿—ç²˜è´´ç»™ ChatGPT/Claude å‰ä½¿ç”¨ï¼š
```powershell
./safemask
æˆ–è€…
./safemask --mode clipboard
```

### 2. æ–‡ä»¶æ¨¡å¼
å¤„ç†å¤§è§„æ¨¡æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ç›´æ¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆæ¨èï¼‰ï¼š
```powershell
./safemask --mode file --path ./input.log --output ./output_masked.log
```

### 3.æ•ˆæœæ¼”ç¤º
#### 3.1 è¾“å…¥
```txt
INFO [2026-01-09] REQ_ID:c6c146f4-5f59-49fb-9af3-ae53dffd80fe | Client: 158.209.138.172 | Phone: 13184327690 | Email: user_c6c146f4@internal.cloud | DNS: node-923.api.service.io | DB: postgres://admin:pwd6435@/db_main | Key: sk-c6c146f4-5f59-49fb-9af3-ae53dffd80fec6c146f4-5f59-49fb-9af3-ae53dffd80fe
INFO [2026-01-09] REQ_ID:fdfbc6fe-6a6f-4a29-ad25-33800e07a54c | Client: 199.203.32.197 | Phone: 15018443387 | Email: user_fdfbc6fe@internal.cloud | DNS: node-806.prod.corp | DB: postgres://admin:pwd6920@/db_main | Key: sk-fdfbc6fe-6a6f-4a29-ad25-33800e07a54cfdfbc6fe-6a6f-4a29-ad25-33800e07a54c
INFO [2026-01-09] REQ_ID:1cee87c0-c759-4a28-9c5a-f53d0795fa33 | Client: 170.35.237.6 | Phone: 15025377154 | Email: user_1cee87c0@prod.corp | DNS: node-176.secure.node | DB: postgres://admin:pwd5656@/db_main | Key: sk-1cee87c0-c759-4a28-9c5a-f53d0795fa331cee87c0-c759-4a28-9c5a-f53d0795fa33
INFO [2026-01-09] REQ_ID:79909f77-e7b6-4cbc-84eb-802894deb6cd | Client: 89.153.179.13 | Phone: 13887270345 | Email: user_79909f77@prod.corp | DNS: node-725.dev.local | DB: postgres://admin:pwd9011@/db_main | Key: sk-79909f77-e7b6-4cbc-84eb-802894deb6cd79909f77-e7b6-4cbc-84eb-802894deb6cd
INFO [2026-01-09] REQ_ID:8c18cfe5-33f9-49f8-a958-2f00d6018dda | Client: 99.21.87.115 | Phone: 18833721927 | Email: user_8c18cfe5@secure.node | DNS: node-448.prod.corp | DB: postgres://admin:pwd4623@/db_main | Key: sk-8c18cfe5-33f9-49f8-a958-2f00d6018dda8c18cfe5-33f9-49f8-a958-2f00d6018dda
INFO [2026-01-09] REQ_ID:4eb8c76e-4626-4b1c-a4b2-23556d727cf5 | Client: 150.161.35.52 | Phone: 18953035548 | Email: user_4eb8c76e@api.service.io | DNS: node-564.prod.corp | DB: postgres://admin:pwd7753@/db_main | Key: sk-4eb8c76e-4626-4b1c-a4b2-23556d727cf54eb8c76e-4626-4b1c-a4b2-23556d727cf5
INFO [2026-01-09] REQ_ID:e9915291-850f-4043-8184-053b51932395 | Client: 158.5.64.110 | Phone: 15026107635 | Email: user_e9915291@internal.cloud | DNS: node-169.secure.node | DB: postgres://admin:pwd4699@/db_main | Key: sk-e9915291-850f-4043-8184-053b51932395e9915291-850f-4043-8184-053b51932395
INFO [2026-01-09] REQ_ID:9c442dbb-24c2-4ba1-a666-22c4dfb32ab8 | Client: 211.100.85.125 | Phone: 15062438861 | Email: user_9c442dbb@secure.node | DNS: node-531.prod.corp | DB: postgres://admin:pwd1412@/db_main | Key: sk-9c442dbb-24c2-4ba1-a666-22c4dfb32ab89c442dbb-24c2-4ba1-a666-22c4dfb32ab8
INFO [2026-01-09] REQ_ID:8aa7a501-7aa1-4cf3-92d9-944652605994 | Client: 123.208.175.66 | Phone: 13174268227 | Email: user_8aa7a501@dev.local | DNS: node-550.internal.cloud | DB: postgres://admin:pwd6410@/db_main | Key: sk-8aa7a501-7aa1-4cf3-92d9-9446526059948aa7a501-7aa1-4cf3-92d9-944652605994
```

#### 3.2 ä½¿ç”¨SafeMaskä¹‹å
```txt
INFO [2026-01-09] REQ_ID:c6c146f4-5f59-49fb-9af3-ae53dffd80fe | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:fdfbc6fe-6a6f-4a29-ad25-33800e07a54c | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:1cee87c0-c759-4a28-9c5a-f53d0795fa33 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:79909f77-e7b6-4cbc-84eb-802894deb6cd | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:8c18cfe5-33f9-49f8-a958-2f00d6018dda | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:4eb8c76e-4626-4b1c-a4b2-23556d727cf5 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:e9915291-850f-4043-8184-053b51932395 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:9c442dbb-24c2-4ba1-a666-22c4dfb32ab8 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:8aa7a501-7aa1-4cf3-92d9-944652605994 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY> 
```

## âš™ï¸ è§„åˆ™å®šåˆ¶æŒ‡å—

### 1. ç›®å½•ç»“æ„
```text
.
â”œâ”€â”€ safemask.exe       # æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ rules/             # [ç³»ç»Ÿçº§] å†…ç½®è§„åˆ™ (IP, Email, API Keysç­‰)
â””â”€â”€ custom/            # [ç”¨æˆ·çº§] åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ç§æœ‰è§„åˆ™
    â”œâ”€â”€ private.yaml
    â””â”€â”€ internal.yaml
```

### 2. é…ç½®ç¤ºä¾‹ (`custom/my_rules.yaml`)
```yaml
group: "MY_CUSTOM_RULES"
rules:
  # å›ºå®šå­—ç¬¦ä¸²åŒ¹é… (æé€Ÿæ¨¡å¼)
  - name: "PersonalName"
    pattern: "xiaosheng"
    mask: "<MY_NAME>"
    priority: 100

  # æ­£åˆ™æ¨¡å¼åŒ¹é…
  - name: "InternalProject"
    pattern: 'PROJ-[0-9]{5,}'
    mask: "<PROJECT_ID>"
    priority: 80
```

---


## ğŸ—ï¸ æ¶æ„èƒŒåçš„æ€è€ƒ

ä½œä¸ºä¸€ä¸ªæ‹¥æœ‰ Java èƒŒæ™¯çš„å¼€å‘è€…ï¼Œæˆ‘åœ¨è®¾è®¡ SafeMask æ—¶é‡ç‚¹è§£å†³äº†ä»¥ä¸‹ç—›ç‚¹ï¼š
1. **è§„é¿ GC åœé¡¿**ï¼šé€šè¿‡ Rust çš„æ‰€æœ‰æƒæ¨¡å‹ä¸ `mimalloc` åˆ†é…å™¨ï¼Œæ¶ˆé™¤å¤§è§„æ¨¡å­—ç¬¦ä¸²å¤„ç†ä¸­çš„åœé¡¿ã€‚
2. **é›¶æ‹·è´ I/O**ï¼šä½¿ç”¨ `Mmap` æ›¿ä»£ä¼ ç»Ÿçš„ç¼“å†²è¯»å–ï¼Œå‡å°‘å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„æ•°æ®æ‹·è´ã€‚
3. **ç®—æ³•èšåˆ**ï¼šé¿å…äº† $N$ æ¬¡ `replace_all` å¯¼è‡´çš„ $O(N \times M)$ å¤æ‚åº¦ï¼Œå°†å…¶ä¼˜åŒ–ä¸º $O(M)$ã€‚
4. **å®‰å…¨æ€§å¤§äºæ ¡éªŒ**ï¼šè„±æ•å¼•æ“å€¾å‘äºâ€œå®å¯é”™æ€ï¼Œä¸å¯æ¼è¿‡â€ï¼Œå³ä½¿æ­£åˆ™åŒ¹é…ç¨å®½ï¼Œä¹Ÿè¦ç¡®ä¿éšç§ä¸æ³„éœ²ã€‚


## ğŸ¤ è´¡çŒ®
æ¬¢è¿æäº¤æ–°çš„è„±æ•è§„åˆ™ï¼š
1. åœ¨ `rules/` ä¸‹åˆ›å»ºåˆ†ç±»ç›®å½•ã€‚
2. éµå¾ª `RULES_TEMP.md` ä¸­çš„éç¯è§†æ­£åˆ™è§„èŒƒã€‚
3. æäº¤ PR å¹¶é™„å¸¦æ€§èƒ½æµ‹è¯•ç»“æœã€‚

---
<div align="center">

**SafeMask** - *è®©æ¯ä¸€è¡Œæ•°æ®éƒ½èƒ½å®‰å…¨åœ°æ‹¥æŠ± AIã€‚*

</div>
</file>

</files>
