This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
Cargo.toml
safemask/.gitignore
safemask/.vscode/extensions.json
safemask/custom/internal.yaml
safemask/custom/private.yaml
safemask/LICENSE
safemask/README.md
safemask/src-tauri/.gitignore
safemask/src-tauri/build.rs
safemask/src-tauri/capabilities/default.json
safemask/src-tauri/Cargo.toml
safemask/src-tauri/icons/128x128.png
safemask/src-tauri/icons/128x128@2x.png
safemask/src-tauri/icons/32x32.png
safemask/src-tauri/icons/icon.icns
safemask/src-tauri/icons/icon.ico
safemask/src-tauri/icons/icon.png
safemask/src-tauri/icons/Square107x107Logo.png
safemask/src-tauri/icons/Square142x142Logo.png
safemask/src-tauri/icons/Square150x150Logo.png
safemask/src-tauri/icons/Square284x284Logo.png
safemask/src-tauri/icons/Square30x30Logo.png
safemask/src-tauri/icons/Square310x310Logo.png
safemask/src-tauri/icons/Square44x44Logo.png
safemask/src-tauri/icons/Square71x71Logo.png
safemask/src-tauri/icons/Square89x89Logo.png
safemask/src-tauri/icons/StoreLogo.png
safemask/src-tauri/rules/auth/ai/keys.yaml
safemask/src-tauri/rules/auth/database/urls.yaml
safemask/src-tauri/rules/network/dns.yaml
safemask/src-tauri/rules/network/ip.yaml
safemask/src-tauri/rules/personal/cardNum.yaml
safemask/src-tauri/rules/personal/email.yaml
safemask/src-tauri/rules/personal/phone.yaml
safemask/src-tauri/rules/rulesTemp.md
safemask/src-tauri/src/clipboard.rs
safemask/src-tauri/src/config.rs
safemask/src-tauri/src/engine.rs
safemask/src-tauri/src/lib.rs
safemask/src-tauri/src/main.rs
safemask/src-tauri/tauri.conf.json
safemask/src/assets/javascript.svg
safemask/src/assets/tauri.svg
safemask/src/index.html
safemask/src/main.js
safemask/src/styles.css
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="safemask/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

/target
/out
/test
</file>

<file path="safemask/.vscode/extensions.json">
{
  "recommendations": ["tauri-apps.tauri-vscode", "rust-lang.rust-analyzer"]
}
</file>

<file path="safemask/custom/internal.yaml">
group: "MY_INFO"
rules:
  - name: "MY_NAME"
    # ç®€åŒ–äº†é€»è¾‘ï¼Œé‡ç‚¹åœ¨äºåŒ¹é… @ å’ŒåŸŸå
    pattern: 'xiaosheng'
    mask: "<MY_NAME>"
    priority: 30 # è¾ƒé«˜ä¼˜å…ˆçº§
</file>

<file path="safemask/custom/private.yaml">

</file>

<file path="safemask/LICENSE">
MIT License

Copyright (c) 2026 xiao sheng

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="safemask/README.md">
# SafeMask
Enabling every line of data to safely embrace AI.
After your content is processed by SafeMask, all private information will be anonymized, allowing your information to be safely transmitted and processed on the internet, by AI, etc.

---

# ğŸ›¡ï¸ SafeMask v0.4.2
[![Rust](https://img.shields.io/badge/language-Rust-orange.svg)](https://www.rust-lang.org/)
[![Performance](https://img.shields.io/badge/performance-300MB%2Fs+-green.svg)](#-performance-benchmarks)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)](#-installation)
[![AI-Friendly](https://img.shields.io/badge/AI-Friendly-brightgreen.svg)](#-ai-friendly-masking)

<div align="center">


 **ğŸ¤—ğŸ›¡ï¸ Enabling every line of data to safely embrace AI**

</div>

## ğŸ“¡ é¡¹ç›®åŠ¨æ€ (Project Roadmap)
| å½¢æ€ | åˆ†æ”¯ | çŠ¶æ€ | æ ¸å¿ƒèƒ½åŠ› |
| :--- | :--- | :--- | :--- |
| ğŸš **CLI å‘½ä»¤è¡Œ** | [`main-cmd`](https://github.com/AiToByte/safemask/tree/main-cmd) | **ç¨³å®šç‰ˆ (Stable)** | é«˜æ€§èƒ½æ–‡ä»¶è„±æ•ã€æ··åˆå¼•æ“ã€ä¿åºæµæ°´çº¿ |
| ğŸ–¥ï¸ **Desktop æ¡Œé¢** | `main` | **ç ”å‘ä¸­ (WIP)** | **Tauri é©±åŠ¨**ã€å‰ªè´´æ¿å®æ—¶ç›‘å¬ã€é™é»˜è„±æ•ã€å¯è§†åŒ–é…ç½® |


> **ğŸ“¢ ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š**
> å¦‚æœæ‚¨éœ€è¦å¤„ç†æœ¬åœ°å¤§è§„æ¨¡æ—¥å¿—ï¼Œæˆ–æ‰‹åŠ¨æ¸…æ´—å‰ªè´´æ¿å†…å®¹ï¼Œè¯·ç‚¹å‡»åˆ‡æ¢è‡³ **[`main-cmd`](https://github.com/AiToByte/safemask/tree/main-cmd)** åˆ†æ”¯ã€‚


> **ğŸ§ª å®éªŒæ€§ç‰¹æ€§é¢„å‘Šï¼š**
> `main` åˆ†æ”¯æ­£åœ¨è¿›è¡Œ **SafeMask Desktop** çš„å°é—­å¼€å‘ã€‚æˆ‘ä»¬åˆ©ç”¨ **Tauri + Rust** çš„é«˜æ€§èƒ½æ¶æ„ï¼Œå®ç°å¯¹ç³»ç»Ÿå‰ªè´´æ¿çš„â€œæ— æ„Ÿç›‘æ§â€â€”â€”æ•æ„Ÿä¿¡æ¯åœ¨è¿›å…¥ AI å¯¹è¯æ¡†å‰å°†è¢«è‡ªåŠ¨æ‹¦æˆªå¹¶æ›¿æ¢ã€‚æ•¬è¯·æœŸå¾…ï¼

## âœ¨ v0.4.2 æ–°ç‰¹æ€§ï¼šçµæ´»å®šåˆ¶ï¼Œæè‡´æ€§èƒ½

*   **ğŸ—‚ï¸ æ³•å®šç›®å½•ç®¡ç†**ï¼šè‡ªåŠ¨æ‰«æ `rules/` (ç³»ç»Ÿå†…ç½®) ä¸ `custom/` (ç”¨æˆ·è‡ªå®šä¹‰) ç›®å½•ï¼Œè§„åˆ™å˜æ›´æ— éœ€é‡æ–°ç¼–è¯‘ã€‚
*   **ğŸš€ æ··åˆåŠ¨åŠ›å¼•æ“**ï¼š
    *   **å›ºå®šè¯è¿‡æ»¤**ï¼šè‡ªåŠ¨è¯†åˆ«çº¯æ–‡æœ¬è§„åˆ™ï¼ˆå¦‚äººåã€é¡¹ç›®åï¼‰ï¼Œé‡‡ç”¨ **Aho-Corasick** ç®—æ³•ï¼Œå®ç° $O(n)$ çº§æé€Ÿè¿‡æ»¤ã€‚
    *   **æ¨¡å¼åŒ¹é…**ï¼šå¤æ‚éšç§æ¨¡å¼é‡‡ç”¨ **é«˜æ€§èƒ½å­—èŠ‚æ­£åˆ™**ï¼Œåˆ†å±‚ä¼˜å…ˆçº§å¤„ç†ã€‚
*   **ğŸ§  AI å‹å¥½å‹è¯­ä¹‰**ï¼šæ”¯æŒå°†æ•æ„Ÿä¿¡æ¯æ›¿æ¢ä¸º `<EMAIL>`ã€`<PROJECT_ID>` ç­‰æ ‡ç­¾ï¼Œè€Œéç ´åæ€§çš„ `***`ã€‚


## ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© SafeMask?

åœ¨ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰æ—¶ä»£ï¼Œå°†æ—¥å¿—æˆ–ä»£ç ç›´æ¥ç²˜è´´ç»™ AI å¤„ç†å­˜åœ¨æé«˜çš„æ³„éœ²é£é™©ã€‚SafeMask è§£å†³äº†ä¸‰å¤§ç—›ç‚¹ï¼š

1.  **AI è¯­ä¹‰ä¿ç•™ (AI-Friendly)**ï¼šä¼ ç»Ÿçš„ `***` æ©ç ä¼šç ´å AI çš„ç†è§£èƒ½åŠ›ã€‚SafeMask ä½¿ç”¨ **è¯­ä¹‰åŒ–æ ‡ç­¾**ï¼ˆå¦‚ `<POSTGRES_URI>`ï¼‰ï¼Œè®© AI çŸ¥é“æ­¤å¤„æ˜¯ä¸€ä¸ªæ•°æ®åº“é“¾æ¥ï¼Œåœ¨ä¸æš´éœ²å¯†ç çš„å‰æä¸‹ä¿ç•™é€»è¾‘ä¸Šä¸‹æ–‡ã€‚
2.  **ç»å¯¹é›¶ä¿¡ä»» (Zero-Trust)**ï¼š100% æœ¬åœ°è¿è¡Œï¼Œä¸äº§ç”Ÿä»»ä½•å¤–ç½‘è¯·æ±‚ï¼Œç¡®ä¿æ•°æ®ä¸å‡ºæœ¬åœ°ã€‚
3.  **æè‡´æ€§èƒ½ (Industrial-Grade)**ï¼šåˆ©ç”¨ Rust çš„å¹¶è¡Œè®¡ç®—å’Œå†…å­˜æ˜ å°„æŠ€æœ¯ï¼Œå¤„ç† GB çº§æ—¥å¿—ä»…éœ€æ•°ç§’ï¼Œæ— æƒ§æµ·é‡æ•°æ®ã€‚
 

---



## ğŸš€ æ ¸å¿ƒæ¶æ„ï¼šä¸‰é˜¶æ®µä¿åºæµæ°´çº¿ (Level 3 Optimization)

SafeMask ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ­£åˆ™æ›¿æ¢å·¥å…·ï¼Œå®ƒé‡‡ç”¨äº†å¤æ‚çš„**ç”Ÿäº§è€…-æ¶ˆè´¹è€…æµæ°´çº¿**æ¨¡å‹ï¼Œå®ç°äº† **CPU è®¡ç®—ä¸ I/O è¯»å†™çš„å®Œå…¨é‡å ï¼ˆOverlappingï¼‰**ã€‚

### ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ
```text
[ åŸå§‹æ•°æ® ] 
     |
     v
( Stage 1: ç”Ÿäº§è€… ) â” å†…å­˜æ˜ å°„ (Mmap) + æ™ºèƒ½å®åˆ†å— (Macro-Chunking 4MB)
     |
     v
( Stage 2: è®¡ç®—é›†ç¾¤ ) â” Rayon å¹¶è¡Œå¤„ç† | å­—èŠ‚æµæ­£åˆ™å¼•æ“ | Aho-Corasick è‡ªåŠ¨æœº
     |
     v
( Stage 3: æ¶ˆè´¹è€… ) â” BTreeMap æ’åºç¼“å†²åŒº | ä¿åºåˆå¹¶ | 8MB èšåˆå†™å…¥ (BufWriter)
     |
     v
[ è„±æ•äº§ç‰© ]
```


### âš¡ æ·±åº¦ä¼˜åŒ–ç»†èŠ‚
- **Zero-Copy I/O**: ä½¿ç”¨ `memmap2` ç»•è¿‡å†…æ ¸ç¼“å†²åŒºæ‹·è´ã€‚
- **Byte-Level Engine**: åŸºäº `regex::bytes` å®ç°ï¼Œå®Œå…¨è·³è¿‡ UTF-8 æ ¡éªŒå¼€é”€ã€‚
- **Context-Aware**: æ™ºèƒ½è¯†åˆ« `sk-`ã€`postgres://` ç­‰ç‰¹å¾ï¼Œç²¾å‡†åŒºåˆ†éšç§ç±»å‹ã€‚
- **Ordered Pipelining**: ç¡®ä¿é«˜å¹¶å‘å¤„ç†åçš„è¾“å‡ºè¡Œåºä¸è¾“å…¥å®Œå…¨ä¸€è‡´ã€‚
- **Memory Reuse**: é‡‡ç”¨çº¿ç¨‹å±€éƒ¨ç¼“å†²åŒºï¼ˆScratch Buffersï¼‰ï¼Œå°†å†…å­˜åˆ†é…å‹åŠ›ä» $O(N)$ é™ä½åˆ° $O(Threads)$ã€‚

## ğŸ“Š æ€§èƒ½åŸºå‡† (Performance Benchmarks)
*æµ‹è¯•ç¯å¢ƒ: Windows 11 / i7-12700K / NVMe SSD*

| æ•°æ®è§„æ¨¡ | åŸå§‹å¤„ç†è€—æ—¶ (PS) | **SafeMask è€—æ—¶** | ååé‡ (Throughput) |
| :--- | :--- | :--- | :--- |
| **113 MB (100ä¸‡è¡Œ)** | 21.9s | **0.42s** | **~270 MB/s** |
| **1.2 GB (500ä¸‡è¡Œ)** | - | **4.1s** | **~300 MB/s** |
| **2.3 GB (1000ä¸‡è¡Œ)** | - | **8.3s** | **~337 MB/s** |

> *æ³¨ï¼šæ€§èƒ½å—é™äºç£ç›˜ I/O ä¸Šé™ã€‚*


## ğŸ¤– AI å‹å¥½å‹è„±æ•ç¤ºä¾‹ (AI-Friendly Masking)

### 3.1 åŸå§‹é£é™©æ•°æ®
> `INFO | User: admin | IP: 158.209.138.172 | DB: postgres://admin:p@ssw0rd123@10.0.0.5:5432/prod | Key: sk-ant-api03-xxxx...`

### 3.2 ä¼ ç»Ÿè„±æ• (AI éš¾ä»¥ç†è§£é€»è¾‘)
> `INFO | User: admin | IP: *.*.*.* | DB: *********** | Key: ***********`
> *AI åé¦ˆ: "ç”±äºä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œæˆ‘æ— æ³•åˆ†ææ‚¨çš„æ•°æ®åº“è¿æ¥é…ç½®..."*

### 3.3 SafeMask è„±æ• (è¯­ä¹‰åŒ–ä¿ç•™)
> `INFO | User: admin | IP: <IPv4> | DB: <POSTGRES_URI> | Key: <CLAUDE_KEY>`
> *AI åé¦ˆ: "æ‚¨çš„ **PostgreSQL** è¿æ¥é…ç½®çœ‹èµ·æ¥æ­£ç¡®ï¼Œä½†è¯·ç¡®ä¿ç«¯å£ **5432** åœ¨é˜²ç«å¢™ä¸­å·²å¼€æ”¾..."*

---


## ğŸ› ï¸ å®‰è£…ä¸ç¼–è¯‘

ç¡®ä¿å·²å®‰è£… Rust ç¯å¢ƒ (MSRV 1.70+)ã€‚

```bash
git clone https://github.com/AiToByte/safemask.git
cd safemask

# å¿…é¡»ä½¿ç”¨ --release æ¨¡å¼ä»¥å¼€å¯æ‰€æœ‰ç¼–è¯‘ä¼˜åŒ–
cargo build --release
```

ç¼–è¯‘äº§ç‰©ä½äº `./target/release/safemask`ã€‚

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. å‰ªè´´æ¿æ¨¡å¼
æœ€é€‚åˆåœ¨å°†ä»£ç æˆ–æ—¥å¿—ç²˜è´´ç»™ ChatGPT/Claude å‰ä½¿ç”¨ï¼š
```powershell
./safemask
æˆ–è€…
./safemask --mode clipboard
```

### 2. æ–‡ä»¶æ¨¡å¼
å¤„ç†å¤§è§„æ¨¡æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ç›´æ¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆæ¨èï¼‰ï¼š
```powershell
./safemask --mode file --path ./input.log --output ./output_masked.log
```

### 3.æ•ˆæœæ¼”ç¤º
#### 3.1 è¾“å…¥
```txt
INFO [2026-01-09] REQ_ID:c6c146f4-5f59-49fb-9af3-ae53dffd80fe | Client: 158.209.138.172 | Phone: 13184327690 | Email: user_c6c146f4@internal.cloud | DNS: node-923.api.service.io | DB: postgres://admin:pwd6435@/db_main | Key: sk-c6c146f4-5f59-49fb-9af3-ae53dffd80fec6c146f4-5f59-49fb-9af3-ae53dffd80fe
INFO [2026-01-09] REQ_ID:fdfbc6fe-6a6f-4a29-ad25-33800e07a54c | Client: 199.203.32.197 | Phone: 15018443387 | Email: user_fdfbc6fe@internal.cloud | DNS: node-806.prod.corp | DB: postgres://admin:pwd6920@/db_main | Key: sk-fdfbc6fe-6a6f-4a29-ad25-33800e07a54cfdfbc6fe-6a6f-4a29-ad25-33800e07a54c
INFO [2026-01-09] REQ_ID:1cee87c0-c759-4a28-9c5a-f53d0795fa33 | Client: 170.35.237.6 | Phone: 15025377154 | Email: user_1cee87c0@prod.corp | DNS: node-176.secure.node | DB: postgres://admin:pwd5656@/db_main | Key: sk-1cee87c0-c759-4a28-9c5a-f53d0795fa331cee87c0-c759-4a28-9c5a-f53d0795fa33
INFO [2026-01-09] REQ_ID:79909f77-e7b6-4cbc-84eb-802894deb6cd | Client: 89.153.179.13 | Phone: 13887270345 | Email: user_79909f77@prod.corp | DNS: node-725.dev.local | DB: postgres://admin:pwd9011@/db_main | Key: sk-79909f77-e7b6-4cbc-84eb-802894deb6cd79909f77-e7b6-4cbc-84eb-802894deb6cd
INFO [2026-01-09] REQ_ID:8c18cfe5-33f9-49f8-a958-2f00d6018dda | Client: 99.21.87.115 | Phone: 18833721927 | Email: user_8c18cfe5@secure.node | DNS: node-448.prod.corp | DB: postgres://admin:pwd4623@/db_main | Key: sk-8c18cfe5-33f9-49f8-a958-2f00d6018dda8c18cfe5-33f9-49f8-a958-2f00d6018dda
INFO [2026-01-09] REQ_ID:4eb8c76e-4626-4b1c-a4b2-23556d727cf5 | Client: 150.161.35.52 | Phone: 18953035548 | Email: user_4eb8c76e@api.service.io | DNS: node-564.prod.corp | DB: postgres://admin:pwd7753@/db_main | Key: sk-4eb8c76e-4626-4b1c-a4b2-23556d727cf54eb8c76e-4626-4b1c-a4b2-23556d727cf5
INFO [2026-01-09] REQ_ID:e9915291-850f-4043-8184-053b51932395 | Client: 158.5.64.110 | Phone: 15026107635 | Email: user_e9915291@internal.cloud | DNS: node-169.secure.node | DB: postgres://admin:pwd4699@/db_main | Key: sk-e9915291-850f-4043-8184-053b51932395e9915291-850f-4043-8184-053b51932395
INFO [2026-01-09] REQ_ID:9c442dbb-24c2-4ba1-a666-22c4dfb32ab8 | Client: 211.100.85.125 | Phone: 15062438861 | Email: user_9c442dbb@secure.node | DNS: node-531.prod.corp | DB: postgres://admin:pwd1412@/db_main | Key: sk-9c442dbb-24c2-4ba1-a666-22c4dfb32ab89c442dbb-24c2-4ba1-a666-22c4dfb32ab8
INFO [2026-01-09] REQ_ID:8aa7a501-7aa1-4cf3-92d9-944652605994 | Client: 123.208.175.66 | Phone: 13174268227 | Email: user_8aa7a501@dev.local | DNS: node-550.internal.cloud | DB: postgres://admin:pwd6410@/db_main | Key: sk-8aa7a501-7aa1-4cf3-92d9-9446526059948aa7a501-7aa1-4cf3-92d9-944652605994
```

#### 3.2 ä½¿ç”¨SafeMaskä¹‹å
```txt
INFO [2026-01-09] REQ_ID:c6c146f4-5f59-49fb-9af3-ae53dffd80fe | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:fdfbc6fe-6a6f-4a29-ad25-33800e07a54c | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:1cee87c0-c759-4a28-9c5a-f53d0795fa33 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:79909f77-e7b6-4cbc-84eb-802894deb6cd | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:8c18cfe5-33f9-49f8-a958-2f00d6018dda | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:4eb8c76e-4626-4b1c-a4b2-23556d727cf5 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:e9915291-850f-4043-8184-053b51932395 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:9c442dbb-24c2-4ba1-a666-22c4dfb32ab8 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY>
INFO [2026-01-09] REQ_ID:8aa7a501-7aa1-4cf3-92d9-944652605994 | Client: <IPv4> | Phone: <CHINA_MOBILE> | Email: <EMAIL> | DNS: 
<DOMAIN> | DB: <POSTGRES_URI> | Key: <OPENAI_KEY> 
```

## âš™ï¸ è§„åˆ™å®šåˆ¶æŒ‡å—

### 1. ç›®å½•ç»“æ„
```text
.
â”œâ”€â”€ safemask.exe       # æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ rules/             # [ç³»ç»Ÿçº§] å†…ç½®è§„åˆ™ (IP, Email, API Keysç­‰)
â””â”€â”€ custom/            # [ç”¨æˆ·çº§] åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ç§æœ‰è§„åˆ™
    â”œâ”€â”€ private.yaml
    â””â”€â”€ internal.yaml
```

### 2. é…ç½®ç¤ºä¾‹ (`custom/my_rules.yaml`)
```yaml
group: "MY_CUSTOM_RULES"
rules:
  # å›ºå®šå­—ç¬¦ä¸²åŒ¹é… (æé€Ÿæ¨¡å¼)
  - name: "PersonalName"
    pattern: "xiaosheng"
    mask: "<MY_NAME>"
    priority: 100

  # æ­£åˆ™æ¨¡å¼åŒ¹é…
  - name: "InternalProject"
    pattern: 'PROJ-[0-9]{5,}'
    mask: "<PROJECT_ID>"
    priority: 80
```

---


## ğŸ—ï¸ æ¶æ„èƒŒåçš„æ€è€ƒ

ä½œä¸ºä¸€ä¸ªæ‹¥æœ‰ Java èƒŒæ™¯çš„å¼€å‘è€…ï¼Œæˆ‘åœ¨è®¾è®¡ SafeMask æ—¶é‡ç‚¹è§£å†³äº†ä»¥ä¸‹ç—›ç‚¹ï¼š
1. **è§„é¿ GC åœé¡¿**ï¼šé€šè¿‡ Rust çš„æ‰€æœ‰æƒæ¨¡å‹ä¸ `mimalloc` åˆ†é…å™¨ï¼Œæ¶ˆé™¤å¤§è§„æ¨¡å­—ç¬¦ä¸²å¤„ç†ä¸­çš„åœé¡¿ã€‚
2. **é›¶æ‹·è´ I/O**ï¼šä½¿ç”¨ `Mmap` æ›¿ä»£ä¼ ç»Ÿçš„ç¼“å†²è¯»å–ï¼Œå‡å°‘å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„æ•°æ®æ‹·è´ã€‚
3. **ç®—æ³•èšåˆ**ï¼šé¿å…äº† $N$ æ¬¡ `replace_all` å¯¼è‡´çš„ $O(N \times M)$ å¤æ‚åº¦ï¼Œå°†å…¶ä¼˜åŒ–ä¸º $O(M)$ã€‚
4. **å®‰å…¨æ€§å¤§äºæ ¡éªŒ**ï¼šè„±æ•å¼•æ“å€¾å‘äºâ€œå®å¯é”™æ€ï¼Œä¸å¯æ¼è¿‡â€ï¼Œå³ä½¿æ­£åˆ™åŒ¹é…ç¨å®½ï¼Œä¹Ÿè¦ç¡®ä¿éšç§ä¸æ³„éœ²ã€‚


## ğŸ¤ è´¡çŒ®
æ¬¢è¿æäº¤æ–°çš„è„±æ•è§„åˆ™ï¼š
1. åœ¨ `rules/` ä¸‹åˆ›å»ºåˆ†ç±»ç›®å½•ã€‚
2. éµå¾ª `RULES_TEMP.md` ä¸­çš„éç¯è§†æ­£åˆ™è§„èŒƒã€‚
3. æäº¤ PR å¹¶é™„å¸¦æ€§èƒ½æµ‹è¯•ç»“æœã€‚

---
<div align="center">

**SafeMask** - *è®©æ¯ä¸€è¡Œæ•°æ®éƒ½èƒ½å®‰å…¨åœ°æ‹¥æŠ± AIã€‚*

</div>
</file>

<file path="safemask/src-tauri/.gitignore">
# Generated by Cargo
# will have compiled files and executables
/target/

# Generated by Tauri
# will have schema files for capabilities auto-completion
/gen/schemas
</file>

<file path="safemask/src-tauri/build.rs">
fn main() {
    tauri_build::build()
}
</file>

<file path="safemask/src-tauri/capabilities/default.json">
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Capability for the main window",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "opener:default"
  ]
}
</file>

<file path="safemask/src-tauri/Cargo.toml">
[package]
name = "safemask"
version = "1.0.0"
description = "A Tauri App"
authors = ["you"]
edition = "2024"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[lib]
# The `_lib` suffix may seem redundant but it is necessary
# to make the lib name unique and wouldn't conflict with the bin name.
# This seems to be only an issue on Windows, see https://github.com/rust-lang/cargo/issues/8519
name = "safemask_lib"
crate-type = ["staticlib", "cdylib", "rlib"]

[build-dependencies]
tauri-build = { version = "2", features = [] }

[dependencies]
# åŸæœ‰æ ¸å¿ƒ
aho-corasick = "1.1.4"
regex = "1.12.2"
rayon = "1.11.0"
memmap2 = "0.9.9"
serde = { version = "1.0", features = ["derive"] }
serde_yaml = "0.9"
walkdir = "2.4"
mimalloc = "0.1"
once_cell = "1.21.3"
anyhow = "1.0"
arboard = "3.6.1"
crossbeam-channel = "0.5"
# æ–¹æ¡ˆä¸€ï¼šåŸç”Ÿäº‹ä»¶é©±åŠ¨å‰ªè´´æ¿ç›‘å¬
clipboard-master = "4.0.0"

# æ–¹æ¡ˆäºŒï¼šå…¨å±€çƒ­é”®æ”¯æŒ (Tauri v2 å®˜æ–¹æ’ä»¶)
tauri-plugin-global-hotkey = "2.0.0"
# ç”¨äºå‘é€ç³»ç»Ÿé€šçŸ¥
tauri-plugin-notification = "2.0.0"

# Tauri å¢å¼º
tokio = { version = "1", features = ["full"] }
tauri = { version = "2", features = ["all"] }
tauri-plugin-opener = "2"
serde_json = "1"
</file>

<file path="safemask/src-tauri/rules/auth/ai/keys.yaml">
group: "SENSITIVE_INFO"
rules:
  # --- AI API KEYS (å»æ‰äº†é”šç‚¹ï¼Œå¢åŠ äº†è¾¹ç•Œåˆ¤å®š) ---
  - name: "OpenAI"
    pattern: '\bsk-[a-zA-Z0-9\-]{32,}\b' # é€‚é… sk-proj åŠé•¿ key
    mask: "<OPENAI_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§
  
  - name: "Anthropic_Claude"
    pattern: '\bsk-ant-api03-[a-zA-Z0-9\-_]{90,100}AA\b'
    mask: "<CLAUDE_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§

  - name: "Google_Gemini"
    pattern: '\bAIzaSy[a-zA-Z0-9\-_]{33}\b'
    mask: "<GEMINI_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§

  - name: "DeepSeek"
    pattern: '\bsk-[a-z0-9]{32}\b'
    mask: "<DEEPSEEK_KEY>"
    priority: 10 # é«˜ä¼˜å…ˆçº§
</file>

<file path="safemask/src-tauri/rules/auth/database/urls.yaml">
group: "DATABASE_CONNECTION"
rules:
  - name: "PostgreSQL_URI"
    # ç§»é™¤äº† ^ å’Œ $ï¼Œä½¿ç”¨ \b (è¯è¾¹ç•Œ) å¹¶åœ¨æœ«å°¾ä½¿ç”¨æ’é™¤å­—ç¬¦é›†ï¼Œç¡®ä¿æŠ“å–åˆ°ç©ºç™½ç¬¦æˆ–å¼•å·ä¸ºæ­¢
    pattern: '\bpostgres(?:ql)?://[^\s''"<>]+'
    mask: "<POSTGRES_URI>"

  - name: "MySQL_URI"
    pattern: '\bmysql(?:\+.+)?://[^\s''"<>]+'
    mask: "<MYSQL_URI>"

  - name: "MongoDB_URI"
    pattern: '\bmongodb(?:\+srv)?://[^\s''"<>]+'
    mask: "<MONGODB_URI>"

  - name: "Redis_URI"
    pattern: '\brediss?://[^\s''"<>]+'
    mask: "<REDIS_URI>"

  - name: "SQLServer_URI"
    pattern: '\bsqlserver://[^\s''"<>]+'
    mask: "<SQLSERVER_URI>"

  - name: "Oracle_URI"
    pattern: '\boracle:thin:@[^\s''"<>]+'
    mask: "<ORACLE_URI>"

  - name: "SQLite_File"
    pattern: '\bsqlite(?:3)?://[^\s''"<>]+'
    mask: "<SQLITE_URI>"
</file>

<file path="safemask/src-tauri/rules/network/dns.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "FQDN_Domain"
    pattern: '\b[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}\b'
    mask: "<DOMAIN>"
    priority: 5 # æ™®é€šä¼˜å…ˆçº§
</file>

<file path="safemask/src-tauri/rules/network/ip.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "IPv4_Address"
    # å…¼é¡¾å‡†ç¡®æ€§ä¸æ€§èƒ½çš„å†™æ³•
    pattern: '\b(?:(?:25[0-5]|2[0-4]\d|1?\d{1,2})\.){3}(?:25[0-5]|2[0-4]\d|1?\d{1,2})\b'
    mask: "<IPv4>"
    priority: 60 # é«˜ä¼˜å…ˆçº§

  - name: "IPv6_Address"
    pattern: '\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b|\b(?:[0-9a-fA-F]{1,4}:){1,7}:|:[:0-9a-fA-F]{1,7}\b'
    mask: "<IPv6>"
    priority: 10
</file>

<file path="safemask/src-tauri/rules/personal/cardNum.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "China_ID_Card_18"
  # èº«ä»½è¯æœ«å°¾å¯èƒ½æ˜¯ Xï¼Œå‰åå¿…é¡»æ˜¯è¯è¾¹ç•Œé˜²æ­¢è¯¯åˆ‡é•¿æ•°å­—
    pattern: '\b[1-9]\d{5}(19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}(\d|X|x)\b'
    mask: "<CHINA_ID_CARD>"
    priority: 100 # æ›´é«˜ä¼˜å…ˆçº§
</file>

<file path="safemask/src-tauri/rules/personal/email.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "Email_Address"
    # ç®€åŒ–äº†é€»è¾‘ï¼Œé‡ç‚¹åœ¨äºåŒ¹é… @ å’ŒåŸŸå
    pattern: '\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b'
    mask: "<EMAIL>"
    priority: 30 # è¾ƒé«˜ä¼˜å…ˆçº§
</file>

<file path="safemask/src-tauri/rules/personal/phone.yaml">
group: "SENSITIVE_INFO"
rules:
  - name: "Global_Phone_E164"
    # å¢åŠ å¯¹ + å·çš„å€¾å‘æˆ–æ›´ä¸¥æ ¼çš„è¾¹ç•Œ
    pattern: '(?:\+|00)[1-9]\d{7,14}\b' 
    mask: "<GLOBAL_PHONE>"
    priority: 5

  - name: "China_Mobile_Phone"
    # å¢åŠ äº†è¾¹ç•Œåˆ¤å®šï¼Œé˜²æ­¢åŒ¹é…åˆ°æ—¶é—´æˆ³ä¸­çš„ä¸€æ®µæ•°å­—
    pattern: '\b1[3-9]\d{9}\b'
    mask: "<CHINA_MOBILE>"
    priority: 100 # æ›´é«˜ä¼˜å…ˆçº§
</file>

<file path="safemask/src-tauri/rules/rulesTemp.md">
ä¸ºäº†ä¿è¯ safemask çš„æè‡´æ€§èƒ½å’ŒåŒ¹é…å‡†ç¡®æ€§ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„èŒƒï¼š
1. æ­£åˆ™ç¼–å†™å‡†åˆ™ (Principles)
è„±æ•è€Œéæ ¡éªŒï¼šæˆ‘ä»¬çš„ç›®çš„æ˜¯é®ç›–éšç§ï¼Œä¸æ˜¯éªŒè¯æ•°æ®çš„åˆæ³•æ€§ã€‚å®å¯é”™æ€ï¼ˆé®ç›–èŒƒå›´ç¨å¤§ï¼‰ï¼Œä¸å¯æ¼è¿‡ã€‚ å¤æ‚çš„æ­£åˆ™ï¼ˆå¦‚ä¸¥æ ¼çš„ Email æ ¡éªŒï¼‰ä¼šæ˜¾è‘—é™ä½åŒ¹é…é€Ÿåº¦ã€‚
è¯è¾¹ç•Œä¼˜å…ˆï¼šå§‹ç»ˆåœ¨æ­£åˆ™ä¸¤ç«¯ä½¿ç”¨ \bã€‚è¿™èƒ½é˜²æ­¢æŠŠ ID_12345678901 ä¸­çš„æ•°å­—è¯¯è®¤ä¸ºæ‰‹æœºå·ã€‚
ç¦ç”¨é”šç‚¹ï¼šä¸¥ç¦åœ¨ rules ä¸­ä½¿ç”¨ ^ å’Œ $ï¼ˆé™¤éä½ ç¡®å®šè¦åŒ¹é…æ•´è¡Œï¼‰ã€‚
ç¦æ­¢ç¯è§†ï¼šRust regex åº“ä¸æ”¯æŒ (?!)ã€(?<=) ç­‰ã€‚å¦‚æœéœ€è¦æ’é™¤ï¼Œè¯·é€šè¿‡å­—ç¬¦é›† [^...] å®ç°ã€‚

group: "CATEGORY_NAME" # å¤§ç±»åç§°ï¼ˆå¦‚ AUTH, PII, NETWORKï¼‰
rules:
  - name: "Rule_Unique_Name" # è§„åˆ™æè¿°å
    # æ¨¡å¼å»ºè®®ï¼š
    # 1. ä½¿ç”¨å•å¼•å·åŒ…è£¹ï¼Œé˜²æ­¢ YAML è½¬ä¹‰å†²çª
    # 2. æ¨¡å¼å¼€å¤´ç»“å°¾å°½é‡ä½¿ç”¨ \b
    # 3. é¿å…è¿‡åº¦ä½¿ç”¨ (.*) ç­‰è´ªå©ªåŒ¹é…
    pattern: '\bPREFIX-[a-zA-Z0-9]{10,}\b'
    mask: "<LABEL>" # å»ºè®®ä½¿ç”¨å¤§å†™+å°–æ‹¬å·ï¼ŒAI è¯†åˆ«æ•ˆæœæœ€å¥½
</file>

<file path="safemask/src-tauri/src/clipboard.rs">
use clipboard_master::{ClipboardHandler, CallbackResult};
use arboard::Clipboard;
use std::sync::{Arc, Mutex};
use crate::engine::MaskEngine;
use tauri::AppHandle;
use tauri::Emitter; // Tauri v2 

pub struct GlobalClipboardHandler {
    pub app_handle: AppHandle,
    pub engine: Arc<MaskEngine>,
    pub last_content: Arc<Mutex<String>>,
    pub is_enabled: Arc<Mutex<bool>>,
}

impl ClipboardHandler for GlobalClipboardHandler {
    /// å½“ç³»ç»Ÿå‰ªè´´æ¿å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒOS ä¼šå›è°ƒæ­¤æ–¹æ³•
    fn on_clipboard_change(&mut self) -> CallbackResult {
        // 1. æ£€æŸ¥è‡ªåŠ¨ç›‘æ§å¼€å…³æ˜¯å¦å¼€å¯
        if !*self.is_enabled.lock().unwrap() {
            return CallbackResult::Next;
        }

        let mut ctx = match Clipboard::new() {
            Ok(c) => c,
            Err(_) => return CallbackResult::Next,
        };
        
        // 2. å°è¯•è·å–æ–‡æœ¬ã€‚å¦‚æœå½“å‰å‰ªè´´æ¿æ˜¯å›¾ç‰‡ã€æ–‡ä»¶æˆ–ç©ºï¼Œget_text() ä¼šè¿”å› Err
        match ctx.get_text() {
            Ok(current_text) => {
                // 3. æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚æœæ–‡æœ¬è¶…çº§å·¨å¤§ï¼ˆä¾‹å¦‚è¶…è¿‡ 2MBï¼‰ï¼Œå»ºè®®è·³è¿‡è‡ªåŠ¨è„±æ•ï¼Œé˜²æ­¢ UI å¡æ­»
                // è¿™ç§å¤§æ•°æ®å»ºè®®å¼•å¯¼ç”¨æˆ·ä½¿ç”¨â€œæ–‡ä»¶æ¨¡å¼â€
                if current_text.len() > 2 * 1024 * 1024 {
                    return CallbackResult::Next;
                }

                let mut last = self.last_content.lock().unwrap();

                // 4. é˜²å¾ªç¯æ ¡éªŒ
                if current_text != *last && !current_text.is_empty() {
                    let masked_bytes = self.engine.mask_line(current_text.as_bytes());
                    let masked_text = String::from_utf8_lossy(&masked_bytes).into_owned();

                    if masked_text != current_text {
                        *last = masked_text.clone();
                        // å°è¯•å†™å›è„±æ•åçš„æ–‡æœ¬
                        if let Ok(_) = ctx.set_text(masked_text) {
                            let _ = self.app_handle.emit("masked-event", "ğŸ›¡ï¸ éšç§å†…å®¹å·²è‡ªåŠ¨è„±æ•");
                        }
                    }
                }
            },
            // 5. é‡ç‚¹ï¼šå¤„ç†éæ–‡æœ¬é”™è¯¯ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶åˆ—è¡¨ç­‰ï¼‰
            Err(e) => {
                match e {
                    ClipboardError::ContentNotAvailable => {
                        // è¿™ç§æƒ…å†µé€šå¸¸æ˜¯ç”¨æˆ·å¤åˆ¶äº†å›¾ç‰‡ã€æ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ•°æ®
                        // æˆ‘ä»¬ä¿æŒæ²‰é»˜ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œç›´æ¥è·³è¿‡
                    },
                    _ => {
                        // è®°å½•å…¶ä»–å¯èƒ½çš„ç³»ç»Ÿçº§é”™è¯¯
                        eprintln!("å‰ªè´´æ¿è®¿é—®å¼‚å¸¸: {:?}", e);
                    }
                }
            }
        }
        CallbackResult::Next
    }

    fn on_clipboard_error(&mut self, error: std::io::Error) -> CallbackResult {
        // è¿™é‡Œçš„é”™è¯¯é€šå¸¸æ˜¯åº•å±‚çš„ç³»ç»Ÿä¿¡å·å¼‚å¸¸
        eprintln!("OS å‰ªè´´æ¿äº‹ä»¶æµä¸­æ–­: {}", error);
        CallbackResult::Next
    }
}
</file>

<file path="safemask/src-tauri/src/config.rs">
use serde::Deserialize;
use std::path::{Path, PathBuf};
use walkdir::WalkDir;
use anyhow::{Result, Context};

#[derive(Debug, Deserialize, Clone)]
pub struct Rule {
    #[allow(dead_code)]
    pub name: String,
    pub pattern: String,
    pub mask: String,
    #[serde(default = "default_priority")] // å¦‚æœYAMLæ²¡å†™ä¼˜å…ˆçº§ï¼Œåˆ™é»˜è®¤ä¸º0
    pub priority: i32,
}

fn default_priority() -> i32 { 0 }

#[derive(Debug, Deserialize, Clone)]
pub struct RuleGroup {
    #[allow(dead_code)]
    #[serde(default)]
    pub group: String,
    pub rules: Vec<Rule>,
}

pub struct RuleManager;


impl RuleManager {
    /// æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨åŠ è½½å†…ç½®è§„åˆ™ç›®å½•å’Œç”¨æˆ·è‡ªå®šä¹‰ç›®å½•
    pub fn load_all_rules() -> Vec<Rule> {
        let mut all_rules = Vec::new();
        
        // è§„å®šä¸¤ä¸ªåŠ è½½è·¯å¾„
        let paths = vec![
            PathBuf::from("rules"),  // å†…ç½®ç›®å½•
            PathBuf::from("custom"), // ç”¨æˆ·è‡ªå®šä¹‰ç›®å½•
        ];

        for path in paths {
            if path.exists() && path.is_dir() {
                all_rules.extend(Self::load_from_directory(path));
            }
        }
        all_rules
    }

    fn load_from_directory<P: AsRef<Path>>(dir: P) -> Vec<Rule> {
        let mut rules = Vec::new();
        for entry in WalkDir::new(dir).into_iter().filter_map(|e| e.ok()) {
            if entry.path().extension().map_or(false, |ext| ext == "yaml") {
                if let Ok(file_rules) = Self::parse_file(entry.path()) {
                    rules.extend(file_rules);
                }
            }
        }
        rules
    }

    fn parse_file(path: &Path) -> Result<Vec<Rule>> {
        let content = std::fs::read_to_string(path)?;
        let group: RuleGroup = serde_yaml::from_str(&content)
            .with_context(|| format!("è§£æè§„åˆ™æ–‡ä»¶å¤±è´¥: {:?}", path))?;
        Ok(group.rules)
    }
}
</file>

<file path="safemask/src-tauri/src/engine.rs">
use crate::config::Rule;
use regex::bytes::{Captures, Regex};
use std::borrow::Cow;
use aho_corasick::{AhoCorasick, MatchKind};

/// è§„åˆ™å±‚çº§ï¼šç”¨äºå­˜å‚¨ç¼–è¯‘åçš„æ­£åˆ™åŠå…¶å¯¹åº”çš„åç§»é‡
struct RegexLayer {
    re: Regex,
    masks: Vec<Vec<u8>>,
    offsets: Vec<usize>,
}

pub struct MaskEngine {
    // å±‚çº§ 1: AC å¼•æ“ (å›ºå®šè¯ï¼Œå¤„ç† O(1) åŒ¹é…)
    ac_engine: Option<AhoCorasick>,
    ac_masks: Vec<Vec<u8>>,

    // å±‚çº§ 2 & 3: ä¼˜å…ˆçº§æ­£åˆ™å¼•æ“
    high_layer: Option<RegexLayer>,
    low_layer: Option<RegexLayer>,
}

impl MaskEngine {
     /// æ„é€ å‡½æ•°ï¼šæ‰§è¡Œè§„åˆ™åˆ†ç±»ã€ä¼˜å…ˆçº§æ’åºã€æ•è·ç»„è®¡ç®—åŠå¼•æ“ç¼–è¯‘
    pub fn new(mut rules: Vec<Rule>) -> Self {
        
        // 1. ä¼˜å…ˆçº§é™åºæ’åºï¼šé«˜ä¼˜å…ˆçº§åœ¨å·¦ä¾§ï¼Œç¬¦åˆæ­£åˆ™å¼•æ“åŒ¹é…åå¥½
        rules.sort_by(|a, b| b.priority.cmp(&a.priority).then_with(|| a.name.cmp(&b.name)));

        let mut ac_p = Vec::new(); let mut ac_m = Vec::new();
        let mut hr_p = Vec::new(); let mut hr_m = Vec::new();
        let mut lr_p = Vec::new(); let mut lr_m = Vec::new();
        
        for rule in rules {
            if is_literal(&rule.pattern) {
                ac_p.push(rule.pattern);
                ac_m.push(rule.mask.as_bytes().to_vec());
            } else if rule.priority > 5 {
                hr_p.push(format!("({})", rule.pattern));
                hr_m.push(rule.mask.as_bytes().to_vec());
            } else {
                lr_p.push(format!("({})", rule.pattern));
                lr_m.push(rule.mask.as_bytes().to_vec());
            }
        }
        
        Self {
            ac_engine: if ac_p.is_empty() { None } else {
                Some(AhoCorasick::builder()
                    .match_kind(MatchKind::LeftmostLongest)
                    .build(ac_p).expect("AC å¼•æ“æ„å»ºå¤±è´¥"))
            },
            ac_masks: ac_m,
            high_layer: Self::compile_layer(hr_p, hr_m),
            low_layer: Self::compile_layer(lr_p, lr_m),
        }
    }

     /// ç¼–è¯‘æ­£åˆ™å±‚ï¼Œå¹¶è®¡ç®—æ¯ä¸ªè§„åˆ™çš„æ•è·ç»„èµ·å§‹ç´¢å¼•
    fn compile_layer(patterns: Vec<String>, masks: Vec<Vec<u8>>) -> Option<RegexLayer> {
        if patterns.is_empty() { return None; }

        let mut offsets = Vec::new();
        let mut current_offset = 1; // 0 æ˜¯æ•´ä¸ªåŒ¹é…é¡¹ï¼Œç¬¬ä¸€ä¸ªè§„åˆ™ä» 1 å¼€å§‹

        for p in &patterns {
            let temp_re = Regex::new(p).expect("æ­£åˆ™è¯­æ³•é”™è¯¯");
            offsets.push(current_offset);
            // temp_re å·²ç»æ˜¯ "(pattern)" å½¢å¼
            // å®ƒåœ¨æ•´ä½“æ­£åˆ™ä¸­å ç”¨çš„ç»„æ•°å°±æ˜¯å®ƒçš„ captures_len() - 1
            // ä½†ç”±äº joined æ˜¯ "(p1)|(p2)"ï¼Œæ¯ä¸€ç»„å…¶å®åªå ç”¨äº†åŸæœ¬çš„ç»„ç©ºé—´
            current_offset += temp_re.captures_len() - 1; // åŠ¨æ€è®¡ç®—è¯¥è§„åˆ™å ç”¨çš„ç»„æ•°é‡
        }

        let combined_re = Regex::new(&patterns.join("|")).expect("è¶…çº§æ­£åˆ™èšåˆå¤±è´¥");

        Some(RegexLayer {
            re: combined_re,
            masks,
            offsets,
        })
    }

    /// æ‰§è¡Œè„±æ•æµç¨‹ï¼šAC -> High Priority Regex -> Low Priority Regex
    pub fn mask_line<'a>(&self, input: &'a [u8]) -> Cow<'a, [u8]> {
        // ç¬¬ä¸€é˜¶æ®µ: AC å¼•æ“
        let mut result = if let Some(ref ac) = self.ac_engine {
            Cow::Owned(ac.replace_all_bytes(input, &self.ac_masks))
        } else {
            Cow::Borrowed(input)
        };

        // ç¬¬äºŒé˜¶æ®µ: é«˜ä¼˜å…ˆçº§æ­£åˆ™
        if let Some(ref layer) = self.high_layer {
            let next = layer.re.replace_all(&result, |caps: &Captures| {
                self.dispatch(layer, caps)
            });
            // å…³é”®ï¼šå¦‚æœå‘ç”Ÿäº†æ›¿æ¢ï¼ˆOwnedï¼‰ï¼Œè½¬ç§»æ‰€æœ‰æƒï¼›å¦åˆ™ä¿æŒåŸæ ·ï¼ˆç»´æŒ 'a ç”Ÿå‘½å‘¨æœŸï¼‰
            result = match next {
                Cow::Owned(v) => Cow::Owned(v),
                Cow::Borrowed(_) => result,
            };
        }

        // ç¬¬ä¸‰é˜¶æ®µ: ä½ä¼˜å…ˆçº§æ­£åˆ™
        if let Some(ref layer) = self.low_layer {
            let next = layer.re.replace_all(&result, |caps: &Captures| {
                self.dispatch(layer, caps)
            });
            result = match next {
                Cow::Owned(v) => Cow::Owned(v),
                Cow::Borrowed(_) => result,
            };
        }
        result
    }

    fn dispatch(&self, layer: &RegexLayer, caps: &Captures) -> Vec<u8> {
        for (i, &offset) in layer.offsets.iter().enumerate() {
            if caps.get(offset).is_some() {
                return layer.masks[i].clone();
            }
        }
        b"<MASKED>".to_vec()
    }  
}

/// ç®€å•çš„è¾…åŠ©å‡½æ•°ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºçº¯æ–‡æœ¬ï¼ˆæ— æ­£åˆ™ç‰¹æ®Šç¬¦å·ï¼‰
fn is_literal(pattern: &str) -> bool {
    let specials = [
        '.', '+', '*', '?', '(', ')', '[', ']', '{', '}', '|', '^', '$', '\\',
    ];
    !pattern.chars().any(|c| specials.contains(&c))
}
</file>

<file path="safemask/src-tauri/src/lib.rs">
// Learn more about Tauri commands at https://tauri.app/develop/calling-rust/
#[tauri::command]
fn greet(name: &str) -> String {
    format!("Hello, {}! You've been greeted from Rust!", name)
}

#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_opener::init())
        .invoke_handler(tauri::generate_handler![greet])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
</file>

<file path="safemask/src-tauri/src/main.rs">
// Prevents additional console window on Windows in release, DO NOT REMOVE!!
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]

mod engine;
mod config;
mod clipboard;

use std::sync::{Arc, Mutex};
use tauri::{Manager, State, AppHandle};
use tauri_plugin_global_hotkey::{GlobalHotkeyExt, Hotkey};
use crate::engine::MaskEngine;
use crate::config::RuleManager;
use crate::clipboard::GlobalClipboardHandler;
use clipboard_master::Master;

// ä½¿ç”¨ mimalloc æå‡å†…å­˜åˆ†é…æ€§èƒ½
#[global_allocator]
static GLOBAL: mimalloc::MiMalloc = mimalloc::MiMalloc;

/// åº”ç”¨å…¨å±€çŠ¶æ€ï¼Œå°†åœ¨ Tauri ç”Ÿå‘½å‘¨æœŸå†…æŒç»­å­˜åœ¨
struct AppState {
    // åŒ…è£…å¼•æ“ï¼Œä½¿å…¶è·¨çº¿ç¨‹å®‰å…¨
    engine: Arc<MaskEngine>,
    // è®°å½•æœ€åä¸€æ¬¡è„±æ•åçš„å†…å®¹ï¼Œé˜²æ­¢â€œå¤„ç† -> å†™å› -> å†æ¬¡æ£€æµ‹åˆ°å˜åŒ–â€çš„æ­»å¾ªç¯
    last_content: Arc<Mutex<String>>,
    // æ§åˆ¶è‡ªåŠ¨ç›‘æ§çš„å¼€å…³
    is_monitor_on: Arc<Mutex<bool>>,
}

/// å‰ç«¯è°ƒç”¨å‘½ä»¤ï¼šå•æ¬¡è„±æ•æ–‡æœ¬
/// æŒ‡ä»¤ï¼šæ‰‹åŠ¨è§¦å‘å½“å‰å‰ªè´´æ¿è„±æ• (ä¾›å‰ç«¯æŒ‰é’®è°ƒç”¨)
#[tauri::command]
async fn manual_mask(state: State<'_, AppState>) -> Result<String, String> {
    let mut ctx = arboard::Clipboard::new().map_err(|e| e.to_string())?;
    let text = ctx.get_text().map_err(|e| e.to_string())?;
    
    let masked = state.engine.mask_line(text.as_bytes());
    let masked_text = String::from_utf8_lossy(&masked).into_owned();
    
    ctx.set_text(masked_text.clone()).map_err(|e| e.to_string())?;
    Ok("æ‰‹åŠ¨è„±æ•æˆåŠŸ".to_string())
}

/// å‰ç«¯è°ƒç”¨å‘½ä»¤ï¼šå¼€å¯/å…³é—­å‰ªè´´æ¿ç›‘æ§
#[tauri::command]
async fn toggle_monitor(enabled: bool, state: State<'_, AppState>) -> Result<(), String> {
    let mut monitor = state.is_monitor_on.lock().await;
    *monitor = enabled;
    println!("ğŸ”” è‡ªåŠ¨ç›‘æ§çŠ¶æ€: {}", enabled);
    Ok(())
}


fn main() {
    // 1. åˆå§‹åŒ–æ ¸å¿ƒå¼•æ“
    let rules = RuleManager::load_all_rules();
    let engine = Arc::new(MaskEngine::new(rules));
    
    // å…±äº«çŠ¶æ€
    let is_monitor_on = Arc::new(Mutex::new(true));
    let last_content = Arc::new(Mutex::new(String::new()));

    let engine_clone = engine.clone();
    let is_monitor_clone = is_monitor_on.clone();
    let last_content_clone = last_content.clone();

    tauri::Builder::default()
        .plugin(tauri_plugin_global_hotkey::Builder::new().build())
        .plugin(tauri_plugin_notification::init())
        .manage(AppState {
            engine: engine.clone(),
            is_monitor_on,
            last_content,
        })
        .invoke_handler(tauri::generate_handler![manual_mask])
        .setup(move |app| {
            let app_handle = app.handle().clone();

            // --- æ–¹æ¡ˆä¸€ï¼šå¯åŠ¨åŸç”Ÿäº‹ä»¶é©±åŠ¨ç›‘å¬çº¿ç¨‹ ---
            std::thread::spawn(move || {
                let handler = GlobalClipboardHandler {
                    app_handle,
                    engine: engine_clone,
                    last_content: last_content_clone,
                    is_enabled: is_monitor_clone,
                };
                // Master::new(handler).run() ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›‘å¬ç³»ç»Ÿå‰ªè´´æ¿ä¿¡å·
                Master::new(handler).run().expect("æ— æ³•å¯åŠ¨å‰ªè´´æ¿ç›‘å¬å™¨");
            });

            // --- æ–¹æ¡ˆäºŒï¼šæ³¨å†Œå…¨å±€çƒ­é”® (Alt+Shift+D) ---
            let hotkey = Hotkey::new(
                Some(tauri_plugin_global_hotkey::Modifiers::ALT | tauri_plugin_global_hotkey::Modifiers::SHIFT),
                tauri_plugin_global_hotkey::Code::KeyD,
            );

            app.global_hotkey().register(hotkey, move |app, _event| {
                // å½“æŒ‰ä¸‹çƒ­é”®æ—¶ï¼Œæ‰§è¡Œè„±æ•
                let state = app.state::<AppState>();
                let mut ctx = arboard::Clipboard::new().unwrap();
                if let Ok(text) = ctx.get_text() {
                    let masked = state.engine.mask_line(text.as_bytes());
                    let masked_text = String::from_utf8_lossy(&masked).into_owned();
                    let _ = ctx.set_text(masked_text);
                    
                    // å‘é€ç³»ç»Ÿé€šçŸ¥
                    app.emit("masked-event", "ğŸš€ çƒ­é”®è§¦å‘ï¼šå†…å®¹å·²å®‰å…¨è„±æ•").unwrap();
                }
            })?;

            Ok(())
        })
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
</file>

<file path="safemask/src-tauri/tauri.conf.json">
{
  "$schema": "https://schema.tauri.app/config/2",
  "productName": "safemask",
  "version": "0.1.0",
  "identifier": "com.xiaoj.safemask",
  "build": {
    "frontendDist": "../src"
  },
  "app": {
    "withGlobalTauri": true,
    "windows": [
      {
        "title": "safemask",
        "width": 800,
        "height": 600
      }
    ],
    "security": {
      "csp": null
    }
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  }
}
</file>

<file path="safemask/src/assets/javascript.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="32" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path fill="#F7DF1E" d="M0 0h256v256H0V0Z"></path><path d="m67.312 213.932l19.59-11.856c3.78 6.701 7.218 12.371 15.465 12.371c7.905 0 12.89-3.092 12.89-15.12v-81.798h24.057v82.138c0 24.917-14.606 36.259-35.916 36.259c-19.245 0-30.416-9.967-36.087-21.996m85.07-2.576l19.588-11.341c5.157 8.421 11.859 14.607 23.715 14.607c9.969 0 16.325-4.984 16.325-11.858c0-8.248-6.53-11.17-17.528-15.98l-6.013-2.58c-17.357-7.387-28.87-16.667-28.87-36.257c0-18.044 13.747-31.792 35.228-31.792c15.294 0 26.292 5.328 34.196 19.247l-18.732 12.03c-4.125-7.389-8.591-10.31-15.465-10.31c-7.046 0-11.514 4.468-11.514 10.31c0 7.217 4.468 10.14 14.778 14.608l6.014 2.577c20.45 8.765 31.963 17.7 31.963 37.804c0 21.654-17.012 33.51-39.867 33.51c-22.339 0-36.774-10.654-43.819-24.574"></path></svg>
</file>

<file path="safemask/src/assets/tauri.svg">
<svg width="206" height="231" viewBox="0 0 206 231" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M143.143 84C143.143 96.1503 133.293 106 121.143 106C108.992 106 99.1426 96.1503 99.1426 84C99.1426 71.8497 108.992 62 121.143 62C133.293 62 143.143 71.8497 143.143 84Z" fill="#FFC131"/>
<ellipse cx="84.1426" cy="147" rx="22" ry="22" transform="rotate(180 84.1426 147)" fill="#24C8DB"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M166.738 154.548C157.86 160.286 148.023 164.269 137.757 166.341C139.858 160.282 141 153.774 141 147C141 144.543 140.85 142.121 140.558 139.743C144.975 138.204 149.215 136.139 153.183 133.575C162.73 127.404 170.292 118.608 174.961 108.244C179.63 97.8797 181.207 86.3876 179.502 75.1487C177.798 63.9098 172.884 53.4021 165.352 44.8883C157.82 36.3744 147.99 30.2165 137.042 27.1546C126.095 24.0926 114.496 24.2568 103.64 27.6274C92.7839 30.998 83.1319 37.4317 75.8437 46.1553C74.9102 47.2727 74.0206 48.4216 73.176 49.5993C61.9292 50.8488 51.0363 54.0318 40.9629 58.9556C44.2417 48.4586 49.5653 38.6591 56.679 30.1442C67.0505 17.7298 80.7861 8.57426 96.2354 3.77762C111.685 -1.01901 128.19 -1.25267 143.769 3.10474C159.348 7.46215 173.337 16.2252 184.056 28.3411C194.775 40.457 201.767 55.4101 204.193 71.404C206.619 87.3978 204.374 103.752 197.73 118.501C191.086 133.25 180.324 145.767 166.738 154.548ZM41.9631 74.275L62.5557 76.8042C63.0459 72.813 63.9401 68.9018 65.2138 65.1274C57.0465 67.0016 49.2088 70.087 41.9631 74.275Z" fill="#FFC131"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M38.4045 76.4519C47.3493 70.6709 57.2677 66.6712 67.6171 64.6132C65.2774 70.9669 64 77.8343 64 85.0001C64 87.1434 64.1143 89.26 64.3371 91.3442C60.0093 92.8732 55.8533 94.9092 51.9599 97.4256C42.4128 103.596 34.8505 112.392 30.1816 122.756C25.5126 133.12 23.9357 144.612 25.6403 155.851C27.3449 167.09 32.2584 177.598 39.7906 186.112C47.3227 194.626 57.153 200.784 68.1003 203.846C79.0476 206.907 90.6462 206.743 101.502 203.373C112.359 200.002 122.011 193.568 129.299 184.845C130.237 183.722 131.131 182.567 131.979 181.383C143.235 180.114 154.132 176.91 164.205 171.962C160.929 182.49 155.596 192.319 148.464 200.856C138.092 213.27 124.357 222.426 108.907 227.222C93.458 232.019 76.9524 232.253 61.3736 227.895C45.7948 223.538 31.8055 214.775 21.0867 202.659C10.3679 190.543 3.37557 175.59 0.949823 159.596C-1.47592 143.602 0.768139 127.248 7.41237 112.499C14.0566 97.7497 24.8183 85.2327 38.4045 76.4519ZM163.062 156.711L163.062 156.711C162.954 156.773 162.846 156.835 162.738 156.897C162.846 156.835 162.954 156.773 163.062 156.711Z" fill="#24C8DB"/>
</svg>
</file>

<file path="safemask/src/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tauri App</title>
    <script type="module" src="/main.js" defer></script>
  </head>

  <body>
    <main class="container">
      <h1>Welcome to Tauri</h1>

      <div class="row">
        <a href="https://tauri.app" target="_blank">
          <img src="/assets/tauri.svg" class="logo tauri" alt="Tauri logo" />
        </a>
        <a
          href="https://developer.mozilla.org/en-US/docs/Web/JavaScript"
          target="_blank"
        >
          <img
            src="/assets/javascript.svg"
            class="logo vanilla"
            alt="JavaScript logo"
          />
        </a>
      </div>
      <p>Click on the Tauri logo to learn more about the framework</p>

      <form class="row" id="greet-form">
        <input id="greet-input" placeholder="Enter a name..." />
        <button type="submit">Greet</button>
      </form>
      <p id="greet-msg"></p>
    </main>
  </body>
</html>
</file>

<file path="safemask/src/main.js">
const { invoke } = window.__TAURI__.core;

let greetInputEl;
let greetMsgEl;

async function greet() {
  // Learn more about Tauri commands at https://tauri.app/develop/calling-rust/
  greetMsgEl.textContent = await invoke("greet", { name: greetInputEl.value });
}

window.addEventListener("DOMContentLoaded", () => {
  greetInputEl = document.querySelector("#greet-input");
  greetMsgEl = document.querySelector("#greet-msg");
  document.querySelector("#greet-form").addEventListener("submit", (e) => {
    e.preventDefault();
    greet();
  });
});
</file>

<file path="safemask/src/styles.css">
.logo.vanilla:hover {
  filter: drop-shadow(0 0 2em #ffe21c);
}
:root {
  font-family: Inter, Avenir, Helvetica, Arial, sans-serif;
  font-size: 16px;
  line-height: 24px;
  font-weight: 400;

  color: #0f0f0f;
  background-color: #f6f6f6;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;
}

.container {
  margin: 0;
  padding-top: 10vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: 0.75s;
}

.logo.tauri:hover {
  filter: drop-shadow(0 0 2em #24c8db);
}

.row {
  display: flex;
  justify-content: center;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}

a:hover {
  color: #535bf2;
}

h1 {
  text-align: center;
}

input,
button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  color: #0f0f0f;
  background-color: #ffffff;
  transition: border-color 0.25s;
  box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
}

button {
  cursor: pointer;
}

button:hover {
  border-color: #396cd8;
}
button:active {
  border-color: #396cd8;
  background-color: #e8e8e8;
}

input,
button {
  outline: none;
}

#greet-input {
  margin-right: 5px;
}

@media (prefers-color-scheme: dark) {
  :root {
    color: #f6f6f6;
    background-color: #2f2f2f;
  }

  a:hover {
    color: #24c8db;
  }

  input,
  button {
    color: #ffffff;
    background-color: #0f0f0f98;
  }
  button:active {
    background-color: #0f0f0f69;
  }
}
</file>

<file path=".gitignore">
# Generated by Cargo
# will have compiled files and executables
debug
target

# These are backup files generated by rustfmt
**/*.rs.bk

# MSVC Windows builds of rustc generate these, which store debugging information
*.pdb

# Generated by cargo mutants
# Contains mutation testing data
**/mutants.out*/

# RustRover
#  JetBrains specific template is maintained in a separate JetBrains.gitignore that can
#  be found at https://github.com/github/gitignore/blob/main/Global/JetBrains.gitignore
#  and can be added to the global gitignore or merged into this file.  For a more nuclear
#  option (not recommended) you can uncomment the following to ignore the entire idea folder.
#.idea/


# Added by cargo

/target
/out
/test
</file>

<file path="Cargo.toml">
[package]
name = "SafeMask"
version = "1.0.0"
edition = "2024" # 2024æœ€æ–°ç‰ˆè¯­æ³•è§„èŒƒ
authors = ["xiaosheng <xiaosheng.tech@outlook.com>"]
description = "A high-performance, ordered data masking tool written in Rust."
license = "MIT"
readme = "README.md"
repository = "https://github.com/AiToByte/SafeMask.git"

[dependencies]
aho-corasick = "1.1.4"
anyhow = "1.0.100"
arboard = "3.6.1"
clap = { version = "4.5.54", features = ["derive"] }
memmap2 = "0.9.9"
once_cell = "1.21.3"
rayon = "1.11.0"
regex = "1.12.2"
serde = {version = "1.0", features = ["derive"]}
serde_yaml = "0.9"
walkdir = "2.4" # ç”¨äºé€’å½’éå†ç›®å½•
mimalloc = "0.1" # å¼•å…¥ mimalocæå‡é¢‘ç¹å†…å­˜åˆ†é…æ€§èƒ½
crossbeam-channel = "0.5"

# æè‡´æ€§èƒ½ä¼˜åŒ–é…ç½®: å½“è¿è¡Œ cargo build --release æ—¶ç”Ÿæ•ˆ
[profile.release]
opt-level = 3
lto = true # å¯ç”¨é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1 # å‡å°‘ä»£ç ç”Ÿæˆå•å…ƒä»¥æé«˜ä¼˜åŒ–æ•ˆæœ
panic = "abort" # å‡å°‘äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°
</file>

</files>
